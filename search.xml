<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Hello World</title>
      <link href="2021/11/18/hello_world/hello_world/"/>
      <url>2021/11/18/hello_world/hello_world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to my Blog!</p><h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="git-config命令预先配置好相关的用户信息"><a href="#git-config命令预先配置好相关的用户信息" class="headerlink" title="git config命令预先配置好相关的用户信息"></a>git config命令预先配置好相关的用户信息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;你的名字或昵称&quot;</span><br><span class="line">git config --global user.email &quot;你的邮箱&quot;</span><br></pre></td></tr></table></figure><h3 id="三步走"><a href="#三步走" class="headerlink" title="三步走"></a>三步走</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add . #将当前目录所有文件添加到git暂存区</span><br><span class="line">git commit -m &quot;my first commit&quot; #提交并备注提交信息</span><br><span class="line">git push origin master #将本地提交推送到远程仓库</span><br></pre></td></tr></table></figure><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="安装的插件"><a href="#安装的插件" class="headerlink" title="安装的插件"></a>安装的插件</h3><h4 id="网址转拼音插件"><a href="#网址转拼音插件" class="headerlink" title="网址转拼音插件"></a>网址转拼音插件</h4><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-permalink-pinyin --save</span><br></pre></td></tr></table></figure><h5 id="配置及使用"><a href="#配置及使用" class="headerlink" title="配置及使用"></a>配置及使用</h5><p>在根目录中的_config.yml中国添加</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 网站 文字转拼音</span></span><br><span class="line"><span class="attr">permalink_pinyin:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">separator:</span> <span class="string">&quot;_&quot;</span> <span class="comment"># default: &#x27;-&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="hexo-electric-clock-电子时钟插件"><a href="#hexo-electric-clock-电子时钟插件" class="headerlink" title="hexo-electric-clock 电子时钟插件"></a>hexo-electric-clock 电子时钟插件</h4><h5 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-electric-clock --save</span><br></pre></td></tr></table></figure><h5 id="配置及使用-1"><a href="#配置及使用-1" class="headerlink" title="配置及使用"></a>配置及使用</h5><p>不是主题的yml文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">electric_clock:</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">layout:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">class</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">sticky_layout</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">temple_html:</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">  &lt;div class=&quot;card-widget card-clock&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;!-- 挂载容器 --&gt;</span></span><br><span class="line"><span class="string">    &lt;div class=&quot;card-glass&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;div class=&quot;card-background&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;card-content&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;div id=&quot;hexo_electric_clock&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;img</span></span><br><span class="line"><span class="string">              id=&quot;card-clock-loading&quot;</span></span><br><span class="line"><span class="string">              src=&quot;https://cdn.jsdelivr.net/gh/Zfour/Butterfly-clock/clock/images/weather/loading.gif&quot;</span></span><br><span class="line"><span class="string">              style=&quot;height: 120px; width: 100%;&quot;</span></span><br><span class="line"><span class="string">              data-ll-status=&quot;loading&quot;</span></span><br><span class="line"><span class="string">              class=&quot;entered loading&quot;</span></span><br><span class="line"><span class="string">            /&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  &lt;/div&gt;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="Chart动态图标插件"><a href="#Chart动态图标插件" class="headerlink" title="Chart动态图标插件"></a>Chart动态图标插件</h4><h5 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-tag-chart --save</span><br></pre></td></tr></table></figure><h5 id="配置及使用-2"><a href="#配置及使用-2" class="headerlink" title="配置及使用"></a>配置及使用</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--fontColor:数据颜色--&gt;</span><br><span class="line">&lt;!--padding:上下左右填充--&gt;</span><br><span class="line">&lt;!--suggestedMin:最小值--&gt;</span><br><span class="line">&#123;% p center logo large, Hello😜 %&#125;</span><br><span class="line"></span><br><span class="line"><span class="strong">**<span class="emphasis">*</span></span></span><br><span class="line"><span class="strong"><span class="emphasis"></span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#123;% p center h1, 一个用JS开发的硬件工程师 😋 %&#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis"></span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#123;% p center small, 雷达图看不到刷新刷新就好啦 %&#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis"></span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#123;% chart 100% 300 %&#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">  type: &#x27;radar&#x27;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">  data: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    labels: [&#x27;C&#x27;, &#x27;Python&#x27;, &#x27;HTML&#x27;, &#x27;micropython&#x27;, &#x27;ESP8266&#x27;, &#x27;ESP32&#x27;, &#x27;STM32&#x27;, &#x27;SCT15&#x27;, &#x27;微信小程序&#x27;],</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    datasets: [&#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    label: &#x27;值&#x27;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    backgroundColor: &#x27;#9400D377&#x27;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    borderColor: &#x27;#9400D3&#x27;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    data: [20, 50, 40, 80, 40, 80, 55, 55, 10],</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    lineTension: 0.2,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    pointStyle: &#x27;rectRounded&#x27;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    pointHoverBackgroundColor: &#x27;#FFFFFF&#x27;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    &#125;]</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">  &#125;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">  options: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    legend: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        labels: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            fontColor: &#x27;#9400D3&#x27;, &lt;!--数据颜色--&gt;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            fontSize: 12,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            FontFamily: &#x27;&#x27;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        &#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    &#125;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    layout: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">      padding: &#123; &lt;!--上下左右填充--&gt;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        left: 0,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        right: 0,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        top: 0,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        bottom: 0</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">      &#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    &#125;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    responsive: true,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    title: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">      display: true,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">      text: &#x27;My dataset&#x27;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    &#125;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    scale: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        angleLines: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            display: true</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        &#125;,</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        ticks: &#123;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            suggestedMin: 0,    &lt;!--最小值--&gt;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">            suggestedMax: 80  &lt;!--最大值--&gt;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">        &#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">    &#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">  &#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis">&#123;% endchart %&#125;</span></span></span><br><span class="line"><span class="strong"><span class="emphasis"></span></span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>树莓派安装Ubuntu21.10</title>
      <link href="2021/11/06/shu_mei_pai_an_zhuang_ubuntu21_10/shu_mei_pai_an_zhuang_ubuntu21_10/"/>
      <url>2021/11/06/shu_mei_pai_an_zhuang_ubuntu21_10/shu_mei_pai_an_zhuang_ubuntu21_10/</url>
      
        <content type="html"><![CDATA[<h2 id="树莓派安装-Ubuntu21-10"><a href="#树莓派安装-Ubuntu21-10" class="headerlink" title="树莓派安装 Ubuntu21.10"></a>树莓派安装 Ubuntu21.10</h2><h3 id="下载、安装烧录工具"><a href="#下载、安装烧录工具" class="headerlink" title="下载、安装烧录工具"></a>下载、安装烧录工具</h3><p>Raspberry Pi Imager：<a target="_blank" rel="noopener" href="https://www.raspberrypi.com/software/">link</a></p><p><img src="1.png" class="lazyload placeholder" data-srcset="1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p><img src="2.png" class="lazyload placeholder" data-srcset="2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><h3 id="烧录过程"><a href="#烧录过程" class="headerlink" title="烧录过程"></a>烧录过程</h3><h4 id="选择镜像"><a href="#选择镜像" class="headerlink" title="选择镜像"></a>选择镜像</h4><p>点击<code>CHOOSE OS</code>，选择<code>Other general purpose OS</code> ，再选择 Ubuntu</p><p><img src="3.png" class="lazyload placeholder" data-srcset="3.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p><img src="4.png" class="lazyload placeholder" data-srcset="4.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p><img src="5.png" class="lazyload placeholder" data-srcset="5.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p>找到与自己树莓派相应的版本，我的是 Raspberry 4，因此选择第一个</p><p><img src="6.png" class="lazyload placeholder" data-srcset="6.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><h4 id="选择-SD-卡设备"><a href="#选择-SD-卡设备" class="headerlink" title="选择 SD 卡设备"></a>选择 SD 卡设备</h4><p>点击<code>CHOOSE STORAGE</code> ，选择自己的 SD 卡设备</p><p><img src="7.png" class="lazyload placeholder" data-srcset="7.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p><img src="8.png" class="lazyload placeholder" data-srcset="8.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p>点击<code>WRITE</code></p><p><img src="9.png" class="lazyload placeholder" data-srcset="9.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p><p>等待烧录完成，拔出 SD 卡，插入树莓派卡槽，插电源开机。至此为树莓派安装 Ubuntu 流程结束，插上显示器后效果如下</p><p><img src="10.png" class="lazyload placeholder" data-srcset="10.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="1.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 树莓派 </tag>
            
            <tag> Ubuntu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SPI通讯协议</title>
      <link href="2021/10/09/spi_tong_xun_xie_yi/spi_tong_xun_xie_yi/"/>
      <url>2021/10/09/spi_tong_xun_xie_yi/spi_tong_xun_xie_yi/</url>
      
        <content type="html"><![CDATA[<p>显示屏 TFT-LCD 信号接口有 SPI、MCU、RGB、LVDS、MIPI、eDP、HDMI 等等多种类型。其中就包括 SPI 协议，SPI 协议还有其他用途，<strong>FLASHRAM</strong>、<strong>网络控制器</strong>、<strong>LCD 显示驱动器</strong>、<strong>A/D 转换器</strong>和<strong>MCU</strong>等。</p><h2 id="SPI-协议"><a href="#SPI-协议" class="headerlink" title="SPI 协议"></a>SPI 协议</h2><h3 id="通信原理"><a href="#通信原理" class="headerlink" title="通信原理"></a>通信原理</h3><p>需要至少 3 根线，分别是 SDI（数据输入）、SDO（数据输出）、SCLK（时钟）、CS（片选）</p><ol><li>SDI – SerialData In,串行数据输入</li><li>SDO – SerialDataOut,串行数据输出</li><li>SCLK – Serial Clock,时钟信号，由主设备产生</li><li>CS – Chip Select,从设备使能信号，由主设备控制</li></ol><p><strong>CS</strong>是<strong>从芯片</strong>是否被<strong>主芯片</strong>选中的控制信号，也就是说只有<strong>片选信号</strong>为预先规定的<strong>使能信号</strong>时（高电位或低电位），主芯片对此从芯片的操作<strong>才有效</strong>。这就使在同一条总线上<strong>连接多个 SPI 设备</strong>成为可能。</p><h3 id="SPI-接口"><a href="#SPI-接口" class="headerlink" title="SPI 接口"></a>SPI 接口</h3><p>SPI 接口是在 CPU 和外围低速器件之间进行<strong>同步串行</strong>数据传输，在<strong>主器件</strong>的移位脉冲下，数据按位传输，<strong>高</strong>位在<strong>前</strong>，<strong>低</strong>位在<strong>后</strong>，为全双工通信，数据传输速度总体来说比<strong>I2C</strong>总线要<strong>快</strong>，速度可达到几 Mbps。</p><p>特点：信号线少，协议简单，相对数据速率高。</p><ol><li><p>MOSI – 主器件数据输出，从器件数据输入</p></li><li><p>MISO – 主器件数据输入，从器件数据输出</p></li><li><p>SCLK –时钟信号，由主器件产生,最大为 fPCLK/2，从模式频率最大为 fCPU/2</p></li><li><p>NSS – 从器件使能信号，由主器件控制,有的 IC 会标注为 CS(Chip select)</p></li></ol><p><strong>#未完待续#</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> SPI </tag>
            
            <tag> tags2 </tag>
            
            <tag> tags3 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为VScode添加背景</title>
      <link href="2021/06/27/wei_vscode_tian_jia_bei_jing/wei_vscode_tian_jia_bei_jing/"/>
      <url>2021/06/27/wei_vscode_tian_jia_bei_jing/wei_vscode_tian_jia_bei_jing/</url>
      
        <content type="html"><![CDATA[<p>原生的vscode无背景，没有理想的好看</p><p><img src="vscode1.png" class="lazyload placeholder" data-srcset="vscode1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="vscode1.png"></p><p>那如何为VScode添加自己喜欢的壁纸呢？</p><p>打开VScode文件所在位置，我的安装路径是<code>C:\Users\用户名\AppData\Local\Programs\Microsoft VS Code\</code><br>再依次打开目录<code>\resources\app\out\vs\workbench</code><br>完整路径是: <code>C:\Users\用户名\AppData\Local\Programs\Microsoft VS Code\resources\app\out\vs\workbench</code><br>打开文件<code>workbench.desktop.main.css</code></p><p><img src="vscode2.png" class="lazyload placeholder" data-srcset="vscode2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="vscode2.png"></p><p>添加如下代码</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="comment">/*背景图片的路径*/</span></span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(C:/Users/用户名/<span class="number">123</span>.jpg);</span><br><span class="line">    <span class="comment">/* 图片不重复 */</span></span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="comment">/* 图片位置 */</span></span><br><span class="line">    <span class="attribute">background-position</span>: center;</span><br><span class="line">    <span class="comment">/* 图片大小 */</span></span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">    <span class="comment">/* 透明度 */</span></span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.7</span>;</span><br><span class="line">    <span class="comment">/* opacity: 0.75; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="vscode3.png" class="lazyload placeholder" data-srcset="vscode3.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="vscode3.png"></p><p><code>Ctrl + S</code>保存，重启VScode即可，效果如下。</p><p><img src="vscode4.png" class="lazyload placeholder" data-srcset="vscode4.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="vscode4.png"></p><p>可能会提示Code可能损坏，这个可以忽略，选择不再提示就可以了。</p><p><img src="vscode5.png" class="lazyload placeholder" data-srcset="vscode5.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="vscode5.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Vscode </tag>
            
            <tag> 美化 </tag>
            
            <tag> DIY </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DS18B20测温芯片驱动代码</title>
      <link href="2021/06/02/ds18b20_ce_wen_xin_pian/ds18b20_ce_wen_xin_pian_qu_dong_dai_ma/"/>
      <url>2021/06/02/ds18b20_ce_wen_xin_pian/ds18b20_ce_wen_xin_pian_qu_dong_dai_ma/</url>
      
        <content type="html"><![CDATA[<p>以下代码在STC15W408AS单片机进行测试，后面还有自制的PCB的原理图和layout设计（因某些原因需要制作这样一块显示温度的小项目，又想节约成本，于是画的十分简陋……）</p><h2 id="DS18B20驱动代码"><a href="#DS18B20驱动代码" class="headerlink" title="DS18B20驱动代码"></a>DS18B20驱动代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stc15.h&quot;</span> <span class="comment">//此处应修改为相应的单片机库</span></span></span><br><span class="line"></span><br><span class="line">sbit DQ = P1^<span class="number">1</span>;  <span class="comment">//此处为连接DS18B20的引脚号</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//单总线延时函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay_OneWire</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> t)</span>  <span class="comment">//STC89C52RC</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line"><span class="keyword">while</span>(t--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过单总线向DS18B20写一个字节</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Write_DS18B20</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">DQ = <span class="number">0</span>;</span><br><span class="line">DQ = dat&amp;<span class="number">0x01</span>;</span><br><span class="line">Delay_OneWire(<span class="number">5</span>);</span><br><span class="line">DQ = <span class="number">1</span>;</span><br><span class="line">dat &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">Delay_OneWire(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从DS18B20读取一个字节</span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">Read_DS18B20</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> dat;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">DQ = <span class="number">0</span>;</span><br><span class="line">dat &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">DQ = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(DQ)</span><br><span class="line">&#123;</span><br><span class="line">dat |= <span class="number">0x80</span>;</span><br><span class="line">&#125;    </span><br><span class="line">Delay_OneWire(<span class="number">5</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//DS18B20设备初始化</span></span><br><span class="line"><span class="function">bit <span class="title">init_ds18b20</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  bit initflag = <span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">  DQ = <span class="number">1</span>;</span><br><span class="line">  Delay_OneWire(<span class="number">12</span>);</span><br><span class="line">  DQ = <span class="number">0</span>;</span><br><span class="line">  Delay_OneWire(<span class="number">80</span>);</span><br><span class="line">  DQ = <span class="number">1</span>;</span><br><span class="line">  Delay_OneWire(<span class="number">10</span>); </span><br><span class="line">    initflag = DQ;     </span><br><span class="line">  Delay_OneWire(<span class="number">5</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> initflag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">rd_temperature</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> low,high;</span><br><span class="line">  <span class="keyword">char</span> temp;</span><br><span class="line">  </span><br><span class="line">  init_ds18b20();</span><br><span class="line">  Write_DS18B20(<span class="number">0xCC</span>);</span><br><span class="line">  Write_DS18B20(<span class="number">0x44</span>); <span class="comment">//启动温度转换</span></span><br><span class="line">  Delay_OneWire(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">  init_ds18b20();</span><br><span class="line">  Write_DS18B20(<span class="number">0xCC</span>);</span><br><span class="line">  Write_DS18B20(<span class="number">0xBE</span>); <span class="comment">//读取寄存器</span></span><br><span class="line"></span><br><span class="line">  low = Read_DS18B20(); <span class="comment">//低字节</span></span><br><span class="line">  high = Read_DS18B20(); <span class="comment">//高字节</span></span><br><span class="line">  </span><br><span class="line">  temp = high&lt;&lt;<span class="number">4</span>;</span><br><span class="line">  temp |= (low&gt;&gt;<span class="number">4</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="PCB文件及其示意图"><a href="#PCB文件及其示意图" class="headerlink" title="PCB文件及其示意图"></a>PCB文件及其示意图</h2><p>PCB文件以压缩包形式打包。<a href="%E6%B8%A9%E6%8E%A7.rar">戳我下载</a><br>注：我画的是拼板，右侧的那块可能地线没有接到一起。</p><h3 id="PCB原件布局"><a href="#PCB原件布局" class="headerlink" title="PCB原件布局"></a>PCB原件布局</h3><p><img src="pcb.jpg" class="lazyload placeholder" data-srcset="pcb.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="pcb.jpg"></p><h3 id="BOM表"><a href="#BOM表" class="headerlink" title="BOM表"></a>BOM表</h3><table><thead><tr><th align="center">Comment</th><th align="center">Description</th><th align="center">Footprint</th><th align="center">Quantity</th></tr></thead><tbody><tr><td align="center">5261AS</td><td align="center">二位共阴数码管</td><td align="center">5261AS</td><td align="center">1</td></tr><tr><td align="center">LED</td><td align="center">发光二极管</td><td align="center">0603</td><td align="center">1</td></tr><tr><td align="center">Header 4</td><td align="center">Header, 4-Pin</td><td align="center">HDR1X4</td><td align="center">1</td></tr><tr><td align="center">Res</td><td align="center">10K</td><td align="center">0603</td><td align="center">1</td></tr><tr><td align="center">Res</td><td align="center">5.1R</td><td align="center">0603</td><td align="center">1</td></tr><tr><td align="center">STC15W408AS</td><td align="center">C51单片机</td><td align="center">SOP-16</td><td align="center">1</td></tr><tr><td align="center">DS18B20模组</td><td align="center">DS18B20模组</td><td align="center">DS18B20模组</td><td align="center">1</td></tr></tbody></table><p>DS18B20模组相关文件由淘宝商家提供，以下是淘宝商家公开的百度网盘连接。<br><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/19CwH6CAaWgVBMKmCA28ygQ">https://pan.baidu.com/s/19CwH6CAaWgVBMKmCA28ygQ</a> 提取码：lggj</p><h2 id="单片机代码"><a href="#单片机代码" class="headerlink" title="单片机代码"></a>单片机代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;stc15.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;intrins.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;onewire.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;absacc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"></span><br><span class="line">sbit LED = P3 ^ <span class="number">2</span>; <span class="comment">//H有效</span></span><br><span class="line">sbit DIGITAL_a = P1 ^ <span class="number">2</span>;</span><br><span class="line">sbit DIGITAL_b = P1 ^ <span class="number">3</span>;</span><br><span class="line">sbit DIGITAL_c = P1 ^ <span class="number">4</span>;</span><br><span class="line">sbit DIGITAL_d = P1 ^ <span class="number">5</span>;</span><br><span class="line">sbit DIGITAL_e = P5 ^ <span class="number">4</span>;  <span class="comment">//sbit DIGITAL_e = P2 ^ 4;</span></span><br><span class="line">sbit DIGITAL_f = P5 ^ <span class="number">5</span>;  <span class="comment">//sbit DIGITAL_e = P2 ^ 5;</span></span><br><span class="line">sbit DIGITAL_g = P1 ^ <span class="number">0</span>;</span><br><span class="line">sbit DIGITAL_dp = P3 ^ <span class="number">7</span>;</span><br><span class="line">sbit DIGITAL_H = P3 ^ <span class="number">6</span>;</span><br><span class="line">sbit DIGITAL_L = P3 ^ <span class="number">3</span>;</span><br><span class="line"><span class="comment">//sbit DQ = P1 ^ 1;</span></span><br><span class="line"></span><br><span class="line">bit temper_flag = <span class="number">0</span>; <span class="comment">//温度读取标志</span></span><br><span class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> intr = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*数码管显示数字*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printf_num</span><span class="params">(num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示1*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示2*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示3*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示4*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">4</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示0*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">5</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示6*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">6</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示7*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">7</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示8*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*显示9*/</span></span><br><span class="line">    <span class="keyword">if</span> (num == <span class="number">9</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        DIGITAL_a = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_b = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_c = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_d = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">        DIGITAL_f = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_g = <span class="number">1</span>;</span><br><span class="line">        DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*数码管显示温度*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printf_wendu</span><span class="params">(num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//printf_num(num/10);</span></span><br><span class="line">    DIGITAL_H = <span class="number">0</span>;</span><br><span class="line">    printf_num(num / <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//    DIGITAL_H = 0;</span></span><br><span class="line">    DIGITAL_H = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    DIGITAL_a = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_b = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_c = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_d = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_g = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Delay_printf_wendu();</span></span><br><span class="line">    <span class="comment">//printf_num(num%10);</span></span><br><span class="line">    DIGITAL_L = <span class="number">0</span>;</span><br><span class="line">    printf_num(num % <span class="number">10</span>);</span><br><span class="line">    <span class="comment">//    DIGITAL_L = 0;</span></span><br><span class="line">    DIGITAL_L = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    DIGITAL_a = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_b = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_c = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_d = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_e = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_f = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_g = <span class="number">0</span>;</span><br><span class="line">    DIGITAL_dp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Delay_printf_wendu();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">float</span> temperature;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (temper_flag)</span><br><span class="line">        &#123;</span><br><span class="line">            temper_flag = <span class="number">0</span>;</span><br><span class="line">            temperature = rd_temperature(); <span class="comment">//读温度</span></span><br><span class="line">temp = temperature;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">printf_wendu(temp);</span><br><span class="line">intr++;</span><br><span class="line">    <span class="keyword">if</span> (intr == <span class="number">100</span>) <span class="comment">//1ms执行一次</span></span><br><span class="line">    &#123;</span><br><span class="line">        intr = <span class="number">0</span>;</span><br><span class="line">        temper_flag = <span class="number">1</span>; <span class="comment">//100ms温度读取标志位置1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> DS18B20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>为Valine评论添加QQ头像识别</title>
      <link href="2021/04/26/wei_valine_ping_lun_tian_jia_qq_tou_xiang_shi_bie/wei_valine_ping_lun_tian_jia_qq_tou_xiang_shi_bie/"/>
      <url>2021/04/26/wei_valine_ping_lun_tian_jia_qq_tou_xiang_shi_bie/wei_valine_ping_lun_tian_jia_qq_tou_xiang_shi_bie/</url>
      
        <content type="html"><![CDATA[<h2 id="Valine"><a href="#Valine" class="headerlink" title="Valine"></a>Valine</h2><p>F12 查看源码</p><p><img src="bug_1.png" class="lazyload placeholder" data-srcset="bug_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="bug_1.png"></p><p>在主题文件夹查询 Valine.js 文件，如果没有 Valine 可以去这里复制下载<a target="_blank" rel="noopener" href="https://unpkg.com/valine@1.4.14/dist/Valine.min.js">link</a></p><p>打开文件 Valine.js，<code>Ctrl + F</code>查询<code>img class=&quot;vimg&quot;</code>，注意绿色框的代码，等下要修改的部分。</p><p>查到后修改</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&lt;img class=&quot;vimg&quot; src=&quot;&#x27;</span> +</span><br><span class="line">  (T.cdn + (<span class="number">0</span>, s.default)(t.get(<span class="string">&quot;mail&quot;</span>)) + T.params) +</span><br><span class="line">  <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>修改为</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&lt;img class=&quot;vimg&quot; src=&quot;&#x27;</span> + qq_img + <span class="string">&#x27;&quot;&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure><p>要添加的代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//var qq_img = m.cdn + a(e.get(&quot;mail&quot;)) + m.params;</span></span><br><span class="line"><span class="keyword">var</span> qq_img = T.cdn + (<span class="number">0</span>, s.default)(t.get(<span class="string">&quot;mail&quot;</span>)) + T.params;</span><br><span class="line"><span class="keyword">if</span> (t.get(<span class="string">&quot;mail&quot;</span>).indexOf(<span class="string">&quot;@qq.com&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> prefix = t.get(<span class="string">&quot;mail&quot;</span>).replace(<span class="regexp">/@.*/</span>, <span class="string">&quot;&quot;</span>);<span class="comment">//前缀</span></span><br><span class="line">  <span class="keyword">var</span> pattern = <span class="regexp">/^\d+$/g</span>;  <span class="comment">//正则表达式</span></span><br><span class="line">  <span class="keyword">var</span> result = prefix.match(pattern);<span class="comment">//match 是匹配的意思</span></span><br><span class="line">  <span class="keyword">if</span> (result !== <span class="literal">null</span>) &#123;</span><br><span class="line">    qq_img = <span class="string">&quot;//q1.qlogo.cn/g?b=qq&amp;nk=&quot;</span> + prefix + <span class="string">&quot;&amp;s=100&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="code_1.png" class="lazyload placeholder" data-srcset="code_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="code_1.png"></p><h2 id="修改流程"><a href="#修改流程" class="headerlink" title="修改流程"></a>修改流程</h2><p>流程：</p><ol><li>默认还是gravator头像接口</li><li>判断是否是qq邮箱，提取前缀prefix</li><li>qq头像接口是qq号，如正则筛选剔除–重命名了带英文的qq邮箱</li><li>拼接头像地址</li><li>加入src显示！</li></ol><p>参考博客链接：<a href="">https://blog.csdn.net/cungudafa/article/details/104638730</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> valine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在material主题使用BBtalk</title>
      <link href="2021/04/25/zai_material_zhu_ti_shi_yong_bbtalk/zai_material_zhu_ti_shi_yong_bbtalk/"/>
      <url>2021/04/25/zai_material_zhu_ti_shi_yong_bbtalk/zai_material_zhu_ti_shi_yong_bbtalk/</url>
      
        <content type="html"><![CDATA[<h2 id="新建BBtalk页面"><a href="#新建BBtalk页面" class="headerlink" title="新建BBtalk页面"></a>新建BBtalk页面</h2><p>终端输入<code>hexo new page bb</code></p><p>打开<a target="_blank" rel="noopener" href="https://bb.js.org/quick-start.html#cdn%E5%BC%95%E7%94%A8">BBtalk</a>文档</p><p>复制<code>CDN引用</code>下方的代码</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 存放哔哔的容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bbtalk&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引用 bbtalk --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bbtalk@0.1.5/dist/bbtalk.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">bbtalk.init(&#123;</span><br><span class="line"><span class="javascript">  appId: <span class="string">&quot;Y5IDwC47czJFXXXXXXSlU44Y-MdYXbMMI&quot;</span>,</span></span><br><span class="line"><span class="javascript">  appKey: <span class="string">&quot;qgrJ3nRwXXXXXXwwnVfj0uaQ&quot;</span>,</span></span><br><span class="line"><span class="javascript">  serverURLs: <span class="string">&#x27;https://AppID前八位.api.lncldglobal.com&#x27;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="./Code_1.png" class="lazyload placeholder" data-srcset="./Code_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="Code_1"></p><p>终端输入<code>hexo s</code>效果如下,圆点位置会有偏差：</p><p><img src="./test_1.png" class="lazyload placeholder" data-srcset="./test_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="test_1"></p><p>打开下方链接，复制js内容，在本地新建一个<code>bbtalk.min.js</code>。</p><p><a href="https://hp-l.gitee.io/phone/bb/bbtalk.min.js">https://hp-l.gitee.io/phone/bb/bbtalk.min.js</a></p><p>再将上文中的复制的<code>CDN引用</code>下方的代码 <code>https://cdn.jsdelivr.net/npm/bbtalk@0.1.5/dist/bbtalk.min.js</code> 改成 <code>./bbtalk.min.js</code></p><p>即</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 存放哔哔的容器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;bbtalk&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引用 bbtalk --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./bbtalk.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">bbtalk.init(&#123;</span><br><span class="line"><span class="javascript">  appId: <span class="string">&quot;Y5IDwC47czJFXXXXXXSlU44Y-MdYXbMMI&quot;</span>,</span></span><br><span class="line"><span class="javascript">  appKey: <span class="string">&quot;qgrJ3nRwXXXXXXwwnVfj0uaQ&quot;</span>,</span></span><br><span class="line"><span class="javascript">  serverURLs: <span class="string">&#x27;https://AppID前八位.api.lncldglobal.com&#x27;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果如下，还需进一步调整。</p><p><img src="./test_2.png" class="lazyload placeholder" data-srcset="./test_2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="test_2.png"><br><img src="test_3.jpg" class="lazyload placeholder" data-srcset="test_3.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="test_3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> material </tag>
            
            <tag> BBtalk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32点亮LED</title>
      <link href="2021/01/31/stm32_dian_liang_led/stm32_dian_liang_led/"/>
      <url>2021/01/31/stm32_dian_liang_led/stm32_dian_liang_led/</url>
      
        <content type="html"><![CDATA[<p>点灯就相当于 python 的<code>print(&quot;hello world&quot;)</code></p><h2 id="定义引脚"><a href="#定义引脚" class="headerlink" title="定义引脚"></a>定义引脚</h2><p>打开工程文件后，找到相应的引脚，单击选择<code>GPIO_Output</code>，再右键选择 Enter User Label，输入定义的名称。</p><p><img src="./LED_1.png" class="lazyload placeholder" data-srcset="./LED_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="工程"></p><p><img src="./LED_2.png" class="lazyload placeholder" data-srcset="./LED_2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="LED_2"><br><img src="./LED_3.png" class="lazyload placeholder" data-srcset="./LED_3.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="LED_3"><br><img src="./LED_4.png" class="lazyload placeholder" data-srcset="./LED_4.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="LED_4"></p><p>点击生成代码</p><p><img src="./CODE_1.png" class="lazyload placeholder" data-srcset="./CODE_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="点击生成代码"><br><img src="./CODE_2.png" class="lazyload placeholder" data-srcset="./CODE_2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="等待生成代码"></p><p>点灯代码如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//点灯代码    LED1闪烁</span></span><br><span class="line"> HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line"> HAL_Delay(<span class="number">300</span>);</span><br></pre></td></tr></table></figure><p>自动生成代码如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END 1 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* MCU Configuration--------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Reset of all peripherals, Initializes the Flash interface and the Systick. */</span></span><br><span class="line">  HAL_Init();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END Init */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure the system clock */</span></span><br><span class="line">  SystemClock_Config();</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END SysInit */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize all configured peripherals */</span></span><br><span class="line">  MX_GPIO_Init();</span><br><span class="line">  <span class="comment">/* USER CODE BEGIN 2 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* USER CODE END 2 */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Infinite loop */</span></span><br><span class="line">  <span class="comment">/* USER CODE BEGIN WHILE */</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line">    <span class="comment">//点灯代码    LED1闪烁</span></span><br><span class="line">    HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);</span><br><span class="line">    HAL_Delay(<span class="number">300</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/* USER CODE END 3 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>连接开发板后点击RUN图标</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="./RUN.png" class="lazyload placeholder" data-srcset="./RUN.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="RUN"/></div><span class="image-caption">RUN</span></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="./successfully.png" class="lazyload placeholder" data-srcset="./successfully.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="successfully"/></div><span class="image-caption">successfully</span></div>]]></content>
      
      
      
        <tags>
            
            <tag> STM32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小程序局域网控制ESP32（物联网芯片）</title>
      <link href="2020/12/16/xiao_cheng_xu_kong_zhi_esp32/xiao_cheng_xu_ju_yu_wang_kong_zhi_esp32_wu_lian_wang_xin_pian/"/>
      <url>2020/12/16/xiao_cheng_xu_kong_zhi_esp32/xiao_cheng_xu_ju_yu_wang_kong_zhi_esp32_wu_lian_wang_xin_pian/</url>
      
        <content type="html"><![CDATA[<h2 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h2><!-- 代码Gitee仓库 --><p>体验版二维码。<br><img src="https://7.dusays.com/2020/12/16/46f7f2a73970e.jpg" class="lazyload placeholder" data-srcset="https://7.dusays.com/2020/12/16/46f7f2a73970e.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="体验版二维码"><br>线上版二维码。</p><div class="img-wrap"><div class="img-bg" style="background:#f4f4f4"><img class="img lazyload placeholder" src="./wechar.jpg" class="lazyload placeholder" data-srcset="./wechar.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="线上版二维码" style="width:200px;"/></div><span class="image-caption">线上版二维码</span></div><p><img src="./wechar.jpg" class="lazyload placeholder" data-srcset="./wechar.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="jpg"></p><p><a target="_blank" rel="noopener" href="https://gitee.com/HP-L/esp32_-we-char_-connect">https://gitee.com/HP-L/esp32_-we-char_-connect</a></p><h2 id="ESP32-代码"><a href="#ESP32-代码" class="headerlink" title="ESP32 代码"></a>ESP32 代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Timer,Pin,RTC <span class="comment">#调用GPIO口调用定时器库</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> emp_wifi <span class="keyword">import</span> Wifi</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> esp32</span><br><span class="line"><span class="keyword">import</span> usocket</span><br><span class="line"><span class="comment"># from machine import Pin, SPI, UART,I2C</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬虫使用库</span></span><br><span class="line"><span class="keyword">import</span> socket,re,sys,os</span><br><span class="line"><span class="keyword">import</span> urequests <span class="keyword">as</span> request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hea = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">rtc = RTC()</span><br><span class="line"></span><br><span class="line">port = <span class="number">10000</span>  <span class="comment">#端口号</span></span><br><span class="line">listenSocket = <span class="literal">None</span>  <span class="comment">#套接字</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line">wifi = network.WLAN(network.STA_IF)</span><br><span class="line">wifi.active(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">A = Pin(<span class="number">17</span>, Pin.OUT, value=<span class="number">0</span>)</span><br><span class="line">B = Pin(<span class="number">12</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">C = Pin(<span class="number">14</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">D = Pin(<span class="number">27</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">E = Pin(<span class="number">26</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">F = Pin(<span class="number">25</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">G = Pin(<span class="number">33</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time_pa</span>():</span></span><br><span class="line">    time_api_url = <span class="string">&quot;&quot;&quot;http://quan.suning.com/getSysTime.do&quot;&quot;&quot;</span></span><br><span class="line">    r = request.get(time_api_url, headers = hea)</span><br><span class="line">    content = r.text</span><br><span class="line">    print(<span class="string">&#x27;爬取时间...&#x27;</span>)</span><br><span class="line">    time = re.search(</span><br><span class="line">        <span class="string">r&#x27;&#123;&quot;sysTime2&quot;:&quot;(.*?)-(.*?)-(.*?) (.*?):(.*?):(.*?)&quot;,&quot;sysTime1&quot;:&quot;&#x27;</span>, content</span><br><span class="line">        )</span><br><span class="line">    print(r.text[<span class="number">13</span>:<span class="number">29</span>])</span><br><span class="line">    print(<span class="built_in">int</span>(r.text[<span class="number">27</span>:<span class="number">29</span>]))</span><br><span class="line">    print(<span class="built_in">int</span>(r.text[<span class="number">23</span>:<span class="number">26</span>]))</span><br><span class="line">    mm = <span class="built_in">int</span>(r.text[<span class="number">27</span>:<span class="number">29</span>])<span class="comment"># 分钟</span></span><br><span class="line">    hh = <span class="built_in">int</span>(r.text[<span class="number">23</span>:<span class="number">26</span>])<span class="comment"># 小时</span></span><br><span class="line">    rtc = RTC()</span><br><span class="line">    time_date = rtc.datetime()</span><br><span class="line">    print(<span class="string">&#x27;重置时间！&#x27;</span>)</span><br><span class="line">    rtc.datetime((time_date[<span class="number">0</span>], time_date[<span class="number">1</span>], time_date[<span class="number">2</span>], time_date[<span class="number">3</span>], hh, mm, time_date[<span class="number">6</span>], time_date[<span class="number">7</span>]))</span><br><span class="line">    rtc.datetime()</span><br><span class="line"></span><br><span class="line"><span class="comment">#自动联网</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wifi_connect</span>():</span></span><br><span class="line">  wifi_led=Pin(<span class="number">12</span>,Pin.OUT)             <span class="comment"># 板载指示灯初始化    MODE1左边</span></span><br><span class="line">  wlan = network.WLAN(network.STA_IF)  <span class="comment"># 以工作站 (wlan) 模式运行，需要创建一个工作站Wi-Fi接口的实例</span></span><br><span class="line">  wlan.active(<span class="literal">True</span>)                    <span class="comment"># 在工作站对象上调用激活方法并以True作为输入值传递来激活网络接口</span></span><br><span class="line">  start_time=time.time()               <span class="comment"># 记录开始时间</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():              <span class="comment"># 如果尚未联网成功</span></span><br><span class="line">    print(<span class="string">&quot;当前无线未联网，正在连接中....&quot;</span>)</span><br><span class="line"><span class="comment">#     wlan.connect(&quot;WiFi名称&quot;, &quot;密码&quot;)   # 无线网SSID、密码，开始联网</span></span><br><span class="line">    wlan.connect(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)   <span class="comment"># 无线网SSID、密码，开始联网</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():         <span class="comment"># 如果还未连接成功，则LED灯闪烁提示</span></span><br><span class="line">      wifi_led.value(<span class="number">1</span>)</span><br><span class="line">      time.sleep_ms(<span class="number">1000</span>)</span><br><span class="line">      wifi_led.value(<span class="number">1</span>)</span><br><span class="line">      time.sleep_ms(<span class="number">1000</span>)</span><br><span class="line">      print(<span class="string">&quot;正在尝试连接到wifi....&quot;</span>)</span><br><span class="line">      print(time.time())</span><br><span class="line">      <span class="keyword">if</span> time.time()-start_time&gt;<span class="number">15</span>:       <span class="comment"># 如果超过15秒还不行，就退出</span></span><br><span class="line">        print(<span class="string">&quot;连接失败!!!无线网连接超过15秒，请检查无线网名称和密码是否正确..&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> wlan.isconnected():                  <span class="comment"># 如果联接成功</span></span><br><span class="line">    wifi_led.value(<span class="number">1</span>)                     <span class="comment"># LED灯常亮</span></span><br><span class="line">    IP_info=wlan.ifconfig()</span><br><span class="line">    print(<span class="string">&quot;##################################################&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;无线网已经连接，信息如下：&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;IP地址：&quot;</span>+IP_info[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">&quot;子网掩码：&quot;</span>+IP_info[<span class="number">1</span>])</span><br><span class="line">    print(<span class="string">&quot;网关：&quot;</span>+IP_info[<span class="number">2</span>])</span><br><span class="line">    print(<span class="string">&quot;DNS：&quot;</span>+IP_info[<span class="number">3</span>])</span><br><span class="line">    print(<span class="string">&quot;##################################################&quot;</span>)</span><br><span class="line">    get_time_pa()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取芯片温度</span></span><br><span class="line"><span class="comment"># def wendu():</span></span><br><span class="line"><span class="comment">#     f = esp32.raw_temperature()</span></span><br><span class="line"><span class="comment">#     c = (f-32)/1.8</span></span><br><span class="line"><span class="comment">#     print(c)</span></span><br><span class="line"><span class="comment">#     oled.text(&quot;IC:&quot; + str(int(c)),20,0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程连接传输命令函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_to_phone</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ip = Wifi.ifconfig()[<span class="number">0</span>][<span class="number">0</span>]   <span class="comment">#获取IP地址</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)   <span class="comment">#设置套接字</span></span><br><span class="line">        sockaddr = socket.getaddrinfo(ip, port)</span><br><span class="line">        print(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        s.bind(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;tcp waiting...&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">            print(<span class="string">&#x27;From %s %s&#x27;</span> % addr)</span><br><span class="line">            print(<span class="string">&#x27;data is %s&#x27;</span> % data)</span><br><span class="line">            data_utf8 = <span class="built_in">bytes</span>.decode(data)</span><br><span class="line">            print(data_utf8)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_on&quot;</span>:</span><br><span class="line">                B.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_on&quot;</span>:</span><br><span class="line">                C.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_off&quot;</span>:</span><br><span class="line">                B.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_off&quot;</span>:</span><br><span class="line">                C.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_on&quot;</span>:</span><br><span class="line">                D.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_on&quot;</span>:</span><br><span class="line">                E.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_off&quot;</span>:</span><br><span class="line">                D.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_off&quot;</span>:</span><br><span class="line">                E.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_on&quot;</span>:</span><br><span class="line">                F.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_on&quot;</span>:</span><br><span class="line">                G.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_off&quot;</span>:</span><br><span class="line">                F.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_off&quot;</span>:</span><br><span class="line">                G.value(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span>(listenSocket):   <span class="comment">#判断套接字是否为空</span></span><br><span class="line">            listenSocket.close()   <span class="comment">#关闭套接字</span></span><br><span class="line"></span><br><span class="line">wifi_connect()</span><br><span class="line">connect_to_phone()</span><br></pre></td></tr></table></figure><p>本程序可连接 OLED1306 也可不连接 OLED1306，不会因为未连接显示屏报错。<br>可直接将 OLED1306 与 ESP32 连接，若不显示，原因可能是接线不稳，接触不良。<br>注意：本程序使用的时 I2C 通讯！！！硬件连接时，I2C必须接上高电平，下面程序是方便面包板使用者使用的程序。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Timer,Pin,RTC <span class="comment">#调用GPIO口调用定时器库</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> emp_wifi <span class="keyword">import</span> Wifi</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> esp32</span><br><span class="line"><span class="keyword">import</span> usocket</span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬虫使用库</span></span><br><span class="line"><span class="keyword">import</span> socket,re,sys,os</span><br><span class="line"><span class="keyword">import</span> urequests <span class="keyword">as</span> request</span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示屏使用库</span></span><br><span class="line"><span class="keyword">import</span> machine, ssd1306, gfx</span><br><span class="line"></span><br><span class="line">hea = &#123;<span class="string">&#x27;User-Agent&#x27;</span>:<span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.118 Safari/537.36&#x27;</span>&#125;</span><br><span class="line">rtc = RTC()</span><br><span class="line"></span><br><span class="line">port = <span class="number">10000</span>  <span class="comment">#端口号</span></span><br><span class="line">listenSocket = <span class="literal">None</span>  <span class="comment">#套接字</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line"></span><br><span class="line">WIFI = Pin(<span class="number">17</span>, Pin.OUT, value=<span class="number">0</span>)</span><br><span class="line">LED_1 = Pin(<span class="number">12</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_2 = Pin(<span class="number">14</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_3 = Pin(<span class="number">27</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_4 = Pin(<span class="number">26</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_5 = Pin(<span class="number">25</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_6 = Pin(<span class="number">33</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">LED_7 = Pin(<span class="number">32</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line">L3 = Pin(<span class="number">13</span>, Pin.OUT, value=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爬时间</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_time_pa</span>():</span></span><br><span class="line">    time_api_url = <span class="string">&quot;&quot;&quot;http://quan.suning.com/getSysTime.do&quot;&quot;&quot;</span></span><br><span class="line">    r = request.get(time_api_url, headers = hea)</span><br><span class="line">    content = r.text</span><br><span class="line">    print(<span class="string">&#x27;爬取时间...&#x27;</span>)</span><br><span class="line">    time = re.search(</span><br><span class="line">        <span class="string">r&#x27;&#123;&quot;sysTime2&quot;:&quot;(.*?)-(.*?)-(.*?) (.*?):(.*?):(.*?)&quot;,&quot;sysTime1&quot;:&quot;&#x27;</span>, content</span><br><span class="line">        )</span><br><span class="line">    print(r.text[<span class="number">13</span>:<span class="number">29</span>])</span><br><span class="line">    print(<span class="built_in">int</span>(r.text[<span class="number">27</span>:<span class="number">29</span>]))</span><br><span class="line">    print(<span class="built_in">int</span>(r.text[<span class="number">23</span>:<span class="number">26</span>]))</span><br><span class="line">    mm = <span class="built_in">int</span>(r.text[<span class="number">27</span>:<span class="number">29</span>])<span class="comment"># 分钟</span></span><br><span class="line">    hh = <span class="built_in">int</span>(r.text[<span class="number">23</span>:<span class="number">26</span>])<span class="comment"># 小时</span></span><br><span class="line">    rtc = RTC()</span><br><span class="line">    time_date = rtc.datetime()</span><br><span class="line">    print(<span class="string">&#x27;重置时间！&#x27;</span>)</span><br><span class="line">    rtc.datetime((time_date[<span class="number">0</span>], time_date[<span class="number">1</span>], time_date[<span class="number">2</span>], time_date[<span class="number">3</span>], hh, mm, time_date[<span class="number">6</span>], time_date[<span class="number">7</span>]))</span><br><span class="line">    rtc.datetime()</span><br><span class="line"></span><br><span class="line"><span class="comment">#自动联网</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wifi_connect</span>():</span></span><br><span class="line">  wifi_led=Pin(<span class="number">23</span>,Pin.OUT)             <span class="comment"># 板载指示灯初始化    MODE1左边</span></span><br><span class="line">  wlan = network.WLAN(network.STA_IF)  <span class="comment"># 以工作站 (wlan) 模式运行，需要创建一个工作站Wi-Fi接口的实例</span></span><br><span class="line">  wlan.active(<span class="literal">True</span>)                    <span class="comment"># 在工作站对象上调用激活方法并以True作为输入值传递来激活网络接口</span></span><br><span class="line">  start_time=time.time()               <span class="comment"># 记录开始时间</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> wlan.isconnected():              <span class="comment"># 如果尚未联网成功</span></span><br><span class="line">    print(<span class="string">&quot;当前无线未联网，正在连接中....&quot;</span>)</span><br><span class="line">    wlan.connect(<span class="string">&#x27;***&#x27;</span>,<span class="string">&#x27;***&#x27;</span>)   <span class="comment"># 无线网SSID、密码，开始联网</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> wlan.isconnected():         <span class="comment"># 如果还未连接成功，则LED灯闪烁提示</span></span><br><span class="line">      wifi_led.value(<span class="number">0</span>)</span><br><span class="line">      time.sleep_ms(<span class="number">1000</span>)</span><br><span class="line">      wifi_led.value(<span class="number">0</span>)</span><br><span class="line">      time.sleep_ms(<span class="number">1000</span>)</span><br><span class="line">      print(<span class="string">&quot;正在尝试连接到wifi....&quot;</span>)</span><br><span class="line">      print(time.time())</span><br><span class="line">      <span class="keyword">if</span> time.time()-start_time&gt;<span class="number">15</span>:       <span class="comment"># 如果超过15秒还不行，就退出</span></span><br><span class="line">        print(<span class="string">&quot;连接失败!!!无线网连接超过15秒，请检查无线网名称和密码是否正确..&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> wlan.isconnected():                  <span class="comment"># 如果联接成功</span></span><br><span class="line">    wifi_led.value(<span class="number">0</span>)                     <span class="comment"># LED灯常亮</span></span><br><span class="line">    IP_info=wlan.ifconfig()</span><br><span class="line">    print(<span class="string">&quot;##################################################&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;无线网已经连接，信息如下：&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;IP地址：&quot;</span>+IP_info[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">&quot;子网掩码：&quot;</span>+IP_info[<span class="number">1</span>])</span><br><span class="line">    print(<span class="string">&quot;网关：&quot;</span>+IP_info[<span class="number">2</span>])</span><br><span class="line">    print(<span class="string">&quot;DNS：&quot;</span>+IP_info[<span class="number">3</span>])</span><br><span class="line">    print(<span class="string">&quot;##################################################&quot;</span>)</span><br><span class="line"><span class="comment">#     get_time_pa()</span></span><br><span class="line"></span><br><span class="line">oled_str1=<span class="string">&#x27;&#x27;</span></span><br><span class="line">oled_str2=<span class="string">&#x27;&#x27;</span></span><br><span class="line">oled_str3=<span class="string">&#x27;&#x27;</span></span><br><span class="line">oled_str4=<span class="string">&#x27;&#x27;</span></span><br><span class="line">oled_str5=<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oled_process</span>(<span class="params">str1,ip,oled,graphics</span>):</span></span><br><span class="line"><span class="comment">#     i2c = machine.I2C(scl=machine.Pin(18), sda=machine.Pin(19))</span></span><br><span class="line"><span class="comment">#     oled = ssd1306.SSD1306_I2C(128 ,64 ,i2c)</span></span><br><span class="line"><span class="comment">#     graphics = gfx.GFX(128, 64, oled.pixel)</span></span><br><span class="line">    <span class="keyword">global</span> oled_str1</span><br><span class="line">    <span class="keyword">global</span> oled_str2</span><br><span class="line">    <span class="keyword">global</span> oled_str3</span><br><span class="line">    <span class="keyword">global</span> oled_str4</span><br><span class="line">    <span class="keyword">global</span> oled_str5</span><br><span class="line">    oled_str1=oled_str2</span><br><span class="line">    oled_str2=oled_str3</span><br><span class="line">    oled_str3=oled_str4</span><br><span class="line">    oled_str4=oled_str5</span><br><span class="line">    oled_str5=str1</span><br><span class="line">    oled.fill(<span class="number">0</span>)</span><br><span class="line">    graphics._slow_vline(<span class="number">0</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">1</span>)</span><br><span class="line">    graphics._slow_vline(<span class="number">127</span>, <span class="number">0</span>, <span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">    graphics._slow_hline(<span class="number">0</span>, <span class="number">15</span>, <span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">    graphics._slow_hline(<span class="number">0</span>, <span class="number">16</span>, <span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">    graphics._slow_hline(<span class="number">0</span>, <span class="number">0</span>, <span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">    graphics._slow_hline(<span class="number">0</span>, <span class="number">63</span>, <span class="number">128</span>, <span class="number">1</span>)</span><br><span class="line">    oled.text(<span class="string">&quot;port:10000 &amp; ip&quot;</span>,<span class="number">0</span>+<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">    oled.text(ip,<span class="number">0</span>+<span class="number">2</span>,<span class="number">8</span>)</span><br><span class="line">    oled.text(oled_str5,<span class="number">0</span>+<span class="number">2</span>,<span class="number">16</span>+<span class="number">2</span>)</span><br><span class="line">    oled.text(oled_str4,<span class="number">0</span>+<span class="number">2</span>,<span class="number">24</span>+<span class="number">2</span>)</span><br><span class="line">    oled.text(oled_str3,<span class="number">0</span>+<span class="number">2</span>,<span class="number">32</span>+<span class="number">2</span>)</span><br><span class="line">    oled.text(oled_str2,<span class="number">0</span>+<span class="number">2</span>,<span class="number">40</span>+<span class="number">2</span>)</span><br><span class="line">    oled.text(oled_str1,<span class="number">0</span>+<span class="number">2</span>,<span class="number">48</span>+<span class="number">2</span>)</span><br><span class="line">    oled.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 显示屏代码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">oled_try</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i2c = machine.I2C(scl=machine.Pin(<span class="number">18</span>), sda=machine.Pin(<span class="number">19</span>))</span><br><span class="line">        oled = ssd1306.SSD1306_I2C(<span class="number">128</span> ,<span class="number">64</span> ,i2c)</span><br><span class="line">        graphics = gfx.GFX(<span class="number">128</span>, <span class="number">64</span>, oled.pixel)</span><br><span class="line">        print(<span class="string">&quot;get&quot;</span>)</span><br><span class="line">        connect_to_phone_oled(oled,graphics)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">&quot;false&quot;</span>)</span><br><span class="line">        connect_to_phone()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取芯片温度</span></span><br><span class="line"><span class="comment"># def wendu():</span></span><br><span class="line"><span class="comment">#     f = esp32.raw_temperature()</span></span><br><span class="line"><span class="comment">#     c = (f-32)/1.8</span></span><br><span class="line"><span class="comment">#     print(c)</span></span><br><span class="line"><span class="comment">#     oled.text(&quot;IC:&quot; + str(int(c)),20,0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_to_phone_oled</span>(<span class="params">oled,graphics</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ip = Wifi.ifconfig()[<span class="number">0</span>][<span class="number">0</span>]   <span class="comment">#获取IP地址</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)   <span class="comment">#设置套接字</span></span><br><span class="line">        sockaddr = socket.getaddrinfo(ip, port)</span><br><span class="line">        print(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        s.bind(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        oled_process(sockaddr[<span class="number">0</span>][<span class="number">4</span>][<span class="number">0</span>],sockaddr[<span class="number">0</span>][<span class="number">4</span>][<span class="number">0</span>],oled,graphics)</span><br><span class="line">        print(<span class="string">&quot;oled&quot;</span>)</span><br><span class="line">        print(<span class="string">&#x27;tcp waiting...&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">            print(<span class="string">&#x27;From %s %s&#x27;</span> % addr)</span><br><span class="line">            print(<span class="string">&#x27;data is %s&#x27;</span> % data)</span><br><span class="line">            data_utf8 = <span class="built_in">bytes</span>.decode(data)</span><br><span class="line">            oled_process(data_utf8,sockaddr[<span class="number">0</span>][<span class="number">4</span>][<span class="number">0</span>],oled,graphics)</span><br><span class="line">            data_size = s.sendto(data, addr)</span><br><span class="line">    <span class="comment">#             print(&#x27;From %s %s&#x27; % data_utf8)</span></span><br><span class="line">    <span class="comment">#             print(&#x27;data is %s&#x27; % data_utf8)</span></span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_on&quot;</span>:</span><br><span class="line">                LED_1.value(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#                 data_size = s.sendto(&quot;led_1_on&quot;, addr)</span></span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_on&quot;</span>:</span><br><span class="line">                LED_2.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_off&quot;</span>:</span><br><span class="line">                LED_1.value(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#                 data_size = s.sendto(&quot;led_1_off&quot;, addr)</span></span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_off&quot;</span>:</span><br><span class="line">                LED_2.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_on&quot;</span>:</span><br><span class="line">                LED_3.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_on&quot;</span>:</span><br><span class="line">                LED_4.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_off&quot;</span>:</span><br><span class="line">                LED_3.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_off&quot;</span>:</span><br><span class="line">                LED_4.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_on&quot;</span>:</span><br><span class="line">                LED_5.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_on&quot;</span>:</span><br><span class="line">                LED_6.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_off&quot;</span>:</span><br><span class="line">                LED_5.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_off&quot;</span>:</span><br><span class="line">                LED_6.value(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_7_on&quot;</span>:</span><br><span class="line">                LED_7.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_7_off&quot;</span>:</span><br><span class="line">                LED_7.value(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span>(listenSocket):   <span class="comment">#判断套接字是否为空</span></span><br><span class="line">            listenSocket.close()   <span class="comment">#关闭套接字</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_to_phone</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ip = Wifi.ifconfig()[<span class="number">0</span>][<span class="number">0</span>]   <span class="comment">#获取IP地址</span></span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)   <span class="comment">#设置套接字</span></span><br><span class="line">        sockaddr = socket.getaddrinfo(ip, port)</span><br><span class="line">        print(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        s.bind(sockaddr[<span class="number">0</span>][<span class="number">4</span>])</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;tcp waiting...&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data, addr = s.recvfrom(<span class="number">1024</span>)</span><br><span class="line">            print(<span class="string">&#x27;From %s %s&#x27;</span> % addr)</span><br><span class="line">            print(<span class="string">&#x27;data is %s&#x27;</span> % data)</span><br><span class="line">            data_utf8 = <span class="built_in">bytes</span>.decode(data)</span><br><span class="line"><span class="comment">#             print(&#x27;From %s %s&#x27; % data_utf8)</span></span><br><span class="line"><span class="comment">#             print(&#x27;data is %s&#x27; % data_utf8)</span></span><br><span class="line">            data_size = s.sendto(data, addr)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_on&quot;</span>:</span><br><span class="line">                LED_1.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_on&quot;</span>:</span><br><span class="line">                LED_2.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_1_off&quot;</span>:</span><br><span class="line">                LED_1.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_2_off&quot;</span>:</span><br><span class="line">                LED_2.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_on&quot;</span>:</span><br><span class="line">                LED_3.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_on&quot;</span>:</span><br><span class="line">                LED_4.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_3_off&quot;</span>:</span><br><span class="line">                LED_3.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_4_off&quot;</span>:</span><br><span class="line">                LED_4.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_on&quot;</span>:</span><br><span class="line">                LED_5.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_on&quot;</span>:</span><br><span class="line">                LED_6.value(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_5_off&quot;</span>:</span><br><span class="line">                LED_5.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_6_off&quot;</span>:</span><br><span class="line">                LED_6.value(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_7_on&quot;</span>:</span><br><span class="line">                LED_7.value(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> data_utf8 == <span class="string">&quot;led_7_off&quot;</span>:</span><br><span class="line">                LED_7.value(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span>(listenSocket):   <span class="comment">#判断套接字是否为空</span></span><br><span class="line">            listenSocket.close()   <span class="comment">#关闭套接字</span></span><br><span class="line"></span><br><span class="line">wifi_connect()</span><br><span class="line">oled_try()</span><br></pre></td></tr></table></figure><h2 id="测试视屏"><a href="#测试视屏" class="headerlink" title="测试视屏"></a>测试视屏</h2><iframe height=520 width=776  src="//player.bilibili.com/player.html?aid=798143285&bvid=BV1Ay4y1D7T9&cid=269108454&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="max-width: 100%, text-align: center" > </iframe>]]></content>
      
      
      
        <tags>
            
            <tag> ESP32 </tag>
            
            <tag> 物联网 </tag>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序学习笔记</title>
      <link href="2020/12/12/wei_xin_xiao_cheng_xu_1/wei_xin_xiao_cheng_xu_xue_xi_bi_ji/"/>
      <url>2020/12/12/wei_xin_xiao_cheng_xu_1/wei_xin_xiao_cheng_xu_xue_xi_bi_ji/</url>
      
        <content type="html"><![CDATA[<h2 id="开发文档链接"><a href="#开发文档链接" class="headerlink" title="开发文档链接"></a>开发文档链接</h2><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/">微信官方文档</a></p><h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><p>全局文件：</p><ul><li>app.js 全局 js 文件：js 代码全局可以调用</li><li>app.json 全局配置文件：导航栏，背景颜色，标题，窗口配置</li><li>app.wxss 全局样式文件：统一样式</li><li>utils 文件夹：封装自定义的工具</li><li>pages 小程序页面文件夹：所有的页面都在该文件夹下管理，pages 文件夹中，一个文件夹代表一个页面。</li></ul><p>局部文件：一个页面的文件</p><ul><li>wxml</li><li>wxss</li><li>js</li><li>json</li></ul><h3 id="app-json"><a href="#app-json" class="headerlink" title="app.json"></a>app.json</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;pages&quot;</span>: [<span class="string">&quot;pages/index/index&quot;</span>, <span class="string">&quot;pages/logs/logs&quot;</span>], <span class="comment">//页面管理</span></span><br><span class="line">  <span class="attr">&quot;window&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">//窗口界面</span></span><br><span class="line">    <span class="attr">&quot;backgroundTextStyle&quot;</span>: <span class="string">&quot;light&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#fff&quot;</span>, <span class="comment">//导航栏颜色</span></span><br><span class="line">    <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;Weixin&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;black&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;style&quot;</span>: <span class="string">&quot;v2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;sitemapLocation&quot;</span>: <span class="string">&quot;sitemap.json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>若要添加页面或者直接在<code>&quot;pages&quot;: [&quot;pages/index/index&quot;, &quot;pages/logs/logs&quot;]</code>中添加，IDE 会直接生成一个文件夹及内部页面文件。</p><p>若在全局配置中窗口界面配置了<code>&quot;navigationBarBackgroundColor&quot;: &quot;#fff&quot;</code>的同时，在单个页面(例如 logo 页面)的配置文件也配置了<code>&quot;navigationBarBackgroundColor&quot;: &quot;#000&quot;</code>，这是只有当跳转到(例如 logo 页面)时，导航栏颜色才会变成#000。</p><h3 id="微信小程序中的-js"><a href="#微信小程序中的-js" class="headerlink" title="微信小程序中的 js"></a>微信小程序中的 js</h3><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>js 变量：用于储存信息的容器<br>声明时使用 var+变量名，变量类型通过赋值来决定<br>注意：变量必须一字母开头，也可以$和_开头，大小写敏感</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> answer = <span class="string">&quot;It&#x27;s alright&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> x1 = <span class="number">43.0</span>;</span><br><span class="line"><span class="keyword">var</span> x = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> cars = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">cars[<span class="number">0</span>] = <span class="string">&quot;Saab&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> cars = [<span class="string">&quot;saab&quot;</span>, <span class="string">&quot;Volor&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> person = <span class="literal">null</span>; <span class="comment">//清空变量内容</span></span><br><span class="line"><span class="keyword">var</span> carname; <span class="comment">//执行后内容为undefined</span></span><br></pre></td></tr></table></figure><h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">  firstname: <span class="string">&quot;John&quot;</span>,</span><br><span class="line">  lastname: <span class="string">&quot;Doe&quot;</span>,</span><br><span class="line">  id: <span class="number">5566</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>对象寻址方式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name = person.lastname;</span><br><span class="line">name = person[<span class="string">&quot;lastname&quot;</span>];</span><br></pre></td></tr></table></figure><h4 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h4><p><code>+</code>,<code>-</code>,<code>*</code>,<code>/</code>,<code>%</code><br>比较运算符，返回值均为<code>FALSE</code>&amp;<code>TRUE</code><br><img src="https://7.dusays.com/2020/12/13/44a7fad2ec4b3.png" class="lazyload placeholder" data-srcset="https://7.dusays.com/2020/12/13/44a7fad2ec4b3.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="比较运算符"></p><p>逻辑运算符<br><code>&amp;&amp;</code>,<code>||</code>,<code>！</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">y = <span class="number">5</span>;</span><br><span class="line">z = <span class="number">2</span>;</span><br><span class="line">x = y + z;</span><br><span class="line">txt1 = <span class="string">&quot;what a very&quot;</span>;</span><br><span class="line">txt2 = <span class="string">&quot;nice day&quot;</span>;</span><br><span class="line">txt3 = txt1 + txt2; <span class="comment">//此时txt3 = &quot;what a verynice day&quot;</span></span><br></pre></td></tr></table></figure><h4 id="条件"><a href="#条件" class="headerlink" title="条件"></a>条件</h4><h5 id="if"><a href="#if" class="headerlink" title="if"></a>if</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="comment">//当condition为true时，才执行下面语句</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="comment">//当condition为true时，才执行下面语句</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//否则执行下面代码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (condition) &#123;</span><br><span class="line">  <span class="comment">//当condition为true时，才执行下面语句</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (condition1) &#123;</span><br><span class="line">  <span class="comment">//否则执行下面代码</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">//否则执行下面代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><h5 id="for"><a href="#for" class="headerlink" title="for"></a>for</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (语句<span class="number">1</span>; 语句<span class="number">2</span>; 语句<span class="number">3</span>) &#123;</span><br><span class="line">  <span class="comment">//被执行的代码，语法和C语言相似</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">  x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="小程序中自动生成的-js-代码"><a href="#小程序中自动生成的-js-代码" class="headerlink" title="小程序中自动生成的 js 代码"></a>小程序中自动生成的 js 代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// pages/index/index.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面的初始数据</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  data: &#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面加载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span> (<span class="params">options</span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面初次渲染完成</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面显示</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShow: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面隐藏</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onHide: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 生命周期函数--监听页面卸载</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onUnload: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onPullDownRefresh: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 页面上拉触底事件的处理函数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onReachBottom: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 用户点击右上角分享</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onShareAppMessage: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="page"><a href="#page" class="headerlink" title="page"></a>page</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  <span class="comment">//页面内容，不写任何东西也不会报错</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h6 id="data-和函数"><a href="#data-和函数" class="headerlink" title="data 和函数"></a>data 和函数</h6><p>data 对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data:&#123;</span><br><span class="line">  msg:<span class="string">&#x27;hello!&#x27;</span>,</span><br><span class="line">  flag:<span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>function 函数</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">参数</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//函数内容</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><h5 id="小程序的生命周期和回掉函数"><a href="#小程序的生命周期和回掉函数" class="headerlink" title="小程序的生命周期和回掉函数"></a>小程序的生命周期和回掉函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">加载</span><br><span class="line"> |</span><br><span class="line">渲染</span><br><span class="line"> |</span><br><span class="line">显示----&gt;隐藏</span><br><span class="line"> |       |</span><br><span class="line"> |       |</span><br><span class="line">卸载&lt;----隐藏</span><br></pre></td></tr></table></figure><p>当程序运行到各个生命周期函数的节点时，会执行生命周期回调函数</p><p>回掉函数：</p><ul><li>onLoad() 页面加载时触发</li><li>onShow() 页面显示/切入前台触发</li><li>onReady() 页面初次渲染完成时触发<br>运行完上面流程即进入激活状态</li><li>onShow() 页面显示/切入前台触发</li><li>onHide() 页面影藏/切入后台触发</li><li>onUnload() 页面卸载时触发</li><li>onPullDownRefresh() 下拉刷新</li><li>onReachBottom()上拉触底事件</li><li>onShareAppMessage() 转发按钮，自定义转发内容</li></ul><h5 id="事件响应"><a href="#事件响应" class="headerlink" title="事件响应"></a>事件响应</h5><p>事件：视图层到逻辑层的通讯方式，将用户的行为反馈到逻辑层<br>即事件可以通过在 wxml 中绑定在组件上，达到触发条件时，会触发相应的事件处理函数(事件响应)对象可以额外携带如 id,dataset 等额外信息</p><p>组建事件响应：</p><ol><li><p>组件上绑定事件处理函数<br>点击事件绑定处理函数的方法：使用<code>bindtap</code>属性，属性值为 js 中的事件的事件处理函数的函数名</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view id=<span class="string">&quot;tapTest&quot;</span> data-hi=<span class="string">&quot;WeChat&quot;</span> bindtab=<span class="string">&quot;tapName&quot;</span>&gt;</span><br><span class="line">  Click me!</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure></li><li><p>Page 中写相应函数处理事件，单数是 event，函数名要和 wxml 中绑定的 bindtap 属性属性值一致</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  <span class="function"><span class="title">tapName</span>(<span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event); <span class="comment">//该语句将获取到的数据打印在了编译器的窗口中</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="小程序-js-数据处理"><a href="#小程序-js-数据处理" class="headerlink" title="小程序 js 数据处理"></a>小程序 js 数据处理</h5></li></ol><h6 id="this-关键字"><a href="#this-关键字" class="headerlink" title="this 关键字"></a>this 关键字</h6><p>this：当前对象的一个引用，在使用时往往指向的是上一层对象，在函数中执行时指向的是全局对象</p><p>访问页面数据：this.data 页面初始数据的那部分<br>调用页面内的函数：this.onload() 执行这一语句就会执行 onload()函数</p><p>tips: 若在 API 中使用 this，需要在调用 API 前暂存指向页面的 this，例</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br></pre></td></tr></table></figure><p>调用方法</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data:&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="string">&#x27;balabala&#x27;</span>,</span><br><span class="line">    c:[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  action:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.data.a=<span class="number">666</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;这是新的函数&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.data)<span class="comment">//调时窗口打印出data中的所有值</span></span><br><span class="line">    <span class="built_in">this</span>.action()<span class="comment">//调用action函数</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h6 id="页面数据更新"><a href="#页面数据更新" class="headerlink" title="页面数据更新"></a>页面数据更新</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.setData(&#123;</span><br><span class="line">  <span class="comment">//变量名：新的值，</span></span><br><span class="line">  <span class="comment">//变量名：新的值，</span></span><br><span class="line">  <span class="comment">//变量名：新的值</span></span><br><span class="line">  a: <span class="number">8888</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h6 id="不同页面的数据出传递"><a href="#不同页面的数据出传递" class="headerlink" title="不同页面的数据出传递"></a>不同页面的数据出传递</h6><p>方法有二，其一，页面跳转过程中携带参数。其二，将数据存于全局数据中，各个页面在从全局中读取</p><p>第二种用法：在 app.js 中</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  globalData: &#123;</span><br><span class="line">    <span class="comment">//globalData可以改成其他名称</span></span><br><span class="line">    userInfo: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>各个页面与全局数据进行交互，使用<code>getApp()</code>历程如下:</p><p>页面的 js 文件如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onLoad:<span class="function"><span class="keyword">function</span>(<span class="params">options</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(getApp().globalData.abc)</span><br><span class="line">  getApp().globalData.abc = <span class="number">456</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>app.js 文件中含有如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">App(&#123;</span><br><span class="line">  globalData: &#123;</span><br><span class="line">    <span class="comment">//globalData可以改成其他名称</span></span><br><span class="line">    userInfo: <span class="literal">null</span>,</span><br><span class="line">    abc: <span class="number">1234</span>,</span><br><span class="line">    d: [],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="微信小程序的-API-介绍"><a href="#微信小程序的-API-介绍" class="headerlink" title="微信小程序的 API 介绍"></a>微信小程序的 API 介绍</h3><p>API 的类型：</p><ul><li>事件监听 API：以 on 开头用于监听</li><li>同步 API：以 Sync 结尾的 API 都是同步 API，起执行结果可通过函数返回值直接获取。当执行到 API 时，停止组件进程等待 API 执行完。</li><li>异步 API：都接受一个 object 类型的参数。程序会启动一个分支来运行 API</li></ul><h4 id="API-内容"><a href="#API-内容" class="headerlink" title="API 内容"></a>API 内容</h4><ul><li>success 部分：接口调用成功的回调函数</li><li>fail 部分：接口调用失败的回调函数</li><li>complete 部分：接口调用结束的回调函数</li></ul><p>微信登陆 API</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wx.login(&#123;</span><br><span class="line">  <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//成功执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">fail</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg);</span><br><span class="line">    <span class="comment">//失败执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">complete</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//一定执行</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>Object 类型参数包含的字段</p><table><thead><tr><th>属性</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>errMsg</td><td>string</td><td>错误信息，若成功为</td></tr><tr><td>errCode</td><td>number</td><td>错误码，成功时为 0</td></tr><tr><td>其他</td><td>Any</td><td>接口返回数据</td></tr></tbody></table><h4 id="调用-API-进行页面互交"><a href="#调用-API-进行页面互交" class="headerlink" title="调用 API 进行页面互交"></a>调用 API 进行页面互交</h4><ol><li>消息提示框</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.showToast(&#123;</span><br><span class="line">  title: <span class="string">&quot;成功&quot;</span>, <span class="comment">//文字</span></span><br><span class="line">  icon: <span class="string">&quot;success&quot;</span>, <span class="comment">//对勾</span></span><br><span class="line">  duration: <span class="number">2000</span>, <span class="comment">//延时时间</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="2"><li>模态弹窗</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.showModal(&#123;</span><br><span class="line">  title: <span class="string">&quot;提示&quot;</span>,</span><br><span class="line">  content: <span class="string">&quot;这是一个模态弹窗&quot;</span>,</span><br><span class="line">  <span class="function"><span class="title">success</span>(<span class="params">res</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;用户点击确定&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&quot;用户点击取消&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>Loading 提示框</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wx.showLoading(&#123;</span><br><span class="line">  title: <span class="string">&quot;加载中&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  wx.hideLoading(); <span class="comment">//必须调用hideLoading才能关闭loading</span></span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure><ol start="4"><li>页面路由 API</li></ol><ul><li><code>wx.relaunch()</code>关闭所有页面，打开到指定页面</li><li><code>wx.redirectTo()</code>关闭当前页面，跳转到指定页面</li><li><code>wx.navigateTo()</code>保留当前页面，跳转到指定页面</li><li><code>wx.navigateBack()</code>关闭当前页面，返回上一级或多级页面</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wx.relaunch(&#123;</span><br><span class="line">  url: <span class="string">&quot;/pages/jsjs/jsjs&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">wx.redirectTo(&#123;</span><br><span class="line">  url: <span class="string">&quot;../jsjs/jsjs&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">wx.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">&quot;/pages/jsjs/jsjs&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">wx.navigateBack(&#123;</span><br><span class="line">  delta: <span class="number">1</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32_物联网那些事</title>
      <link href="2020/12/03/esp32_wu_lian_wang_na_xie_shi/esp32_wu_lian_wang_na_xie_shi/"/>
      <url>2020/12/03/esp32_wu_lian_wang_na_xie_shi/esp32_wu_lian_wang_na_xie_shi/</url>
      
        <content type="html"><![CDATA[<h2 id="ESP32-物联网那些事"><a href="#ESP32-物联网那些事" class="headerlink" title="ESP32_物联网那些事"></a>ESP32_物联网那些事</h2><p>通过查阅资料，ESP32 是一款物联网模块，它支持 TCP/IP 协议，于是我们可以使用 socket 通讯，实现局域网通信，它也支持 MQTT 通讯，呵远程连接到阿里云。下面的链接有详细的使用说明。</p><p><a target="_blank" rel="noopener" href="http://www.1zlab.com/wiki/micropython-esp32/sockets/">Socket 通信</a></p><h2 id="使用物联网第一步：烧录固件"><a href="#使用物联网第一步：烧录固件" class="headerlink" title="使用物联网第一步：烧录固件"></a>使用物联网第一步：烧录固件</h2><p>这里提到的固件是micropython官方出的固件，我在网上还看到了不少通过C语言写.bin固件的教程，可以写自己需要的固件刷入到ESP32中</p><p>可以参考这篇文章</p><p><a href="https://hp-l.gitee.io/2020/11/05/ESP32-micropython%E5%9B%BA%E4%BB%B6%E7%83%A7%E5%BD%95/esp32-micropython%E5%9B%BA%E4%BB%B6%E7%83%A7%E5%BD%95/?t=1606983183242">ESP32_micropython固件烧录</a></p><h2 id="如何连接到-WiFi？"><a href="#如何连接到-WiFi？" class="headerlink" title="如何连接到 WiFi？"></a>如何连接到 WiFi？</h2><p><a href="https://hp-l.gitee.io/2020/11/09/micropython%E8%81%94%E7%BD%91%E5%90%8C%E6%AD%A5%E6%97%B6%E9%97%B4/micropython%E8%81%94%E7%BD%91%E5%90%8C%E6%AD%A5%E6%97%B6%E9%97%B4/?t=1606983747012">Micropython联网同步时间</a></p><p>ESP32 是可以使用 REPL 的，REPL 就像局域网下的 VSCode，可以在浏览器上编写程序，可惜他不能开机自启，于是就有人开发了一款叫做 EMP 的 IDE ，下面有链接。</p><p><a target="_blank" rel="noopener" href="http://www.1zlab.com/wiki/micropython-esp32/emp-project/">EMP项目简介</a></p><p>我在执行原文提供的代码时发现<code>set_boot_mode()</code>报错</p><p>原文提供的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> emp_boot <span class="keyword">import</span> set_boot_mode</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_boot_mode()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> emp_boot <span class="keyword">import</span> set_boot_mode</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>set_boot_mode()</span><br><span class="line">[<span class="number">0</span>]  Boot <span class="keyword">with</span> nothing</span><br><span class="line">     attention: this option will clear up boot.py, careful!</span><br><span class="line">[<span class="number">1</span>]  Boot <span class="keyword">with</span> wifi startup</span><br><span class="line">       this mode will auto start wifi connect program.</span><br><span class="line">[<span class="number">2</span>]  Easy to develop</span><br><span class="line">     this mode <span class="keyword">is</span> <span class="keyword">for</span> developers.In this mode you can develop much easier via EMP-         IDE(emp<span class="number">.1</span>zlab.com)</span><br><span class="line">Please <span class="built_in">input</span> your choice [<span class="number">0</span>-<span class="number">2</span>]:</span><br></pre></td></tr></table></figure><p>下面给出解决方案：</p><p>在 ESP32 的 boot.py 中所有代码替换成如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> emp_wifi <span class="keyword">import</span> Wifi</span><br><span class="line"><span class="keyword">from</span> emp_webrepl <span class="keyword">import</span> WebREPL</span><br><span class="line"><span class="keyword">from</span> emp_utils <span class="keyword">import</span> webrepl_pass</span><br><span class="line"><span class="keyword">from</span> emp_utils <span class="keyword">import</span> post_ip</span><br><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Pin <span class="comment"># 引用LED使用</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">wifi_LED = Pin(<span class="number">12</span>, Pin.OUT, value=<span class="number">1</span>) <span class="comment">#定义LED</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Wifi.connect()</span><br><span class="line">    post_ip(Wifi.ifconfig()[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">    wifi_LED.value(<span class="number">0</span>)</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    wifi_LED.value(<span class="number">1</span>)</span><br><span class="line"><span class="comment">#     WebREPL.start(password=webrepl_pass())</span></span><br><span class="line"><span class="comment">#     from emp_ide import *</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">上面两行是调用emp_ide，取消注释就可以使用emp_ide，</span></span><br><span class="line"><span class="string">这里注释掉的原因是想直接调用连接WiFi的函数不使用emp_ide</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在按复位即可，终端中会提示连接网络并且输入密码，连接过的 WiFi 会被记住，下次连接自动连，非常方便</p><h2 id="利用-ESP32-联网实现一些小功能"><a href="#利用-ESP32-联网实现一些小功能" class="headerlink" title="利用 ESP32 联网实现一些小功能"></a>利用 ESP32 联网实现一些小功能</h2><p>我们可以通过 socket 通讯使得 PC 可以传输数据流到 ESP32 中，下面是代码，这里仿照的是<a target="_blank" rel="noopener" href="http://www.1zlab.com/wiki/micropython-esp32/sockets/">Socket 通信</a>文末的代码，原文中代码只能传输字节，下面代码可以传输中文字符，通过定义 IO 口可以实现局域网点亮 LED，甚至舵机。</p><h3 id="ESP32-TCP-服务端"><a href="#ESP32-TCP-服务端" class="headerlink" title="ESP32 TCP 服务端"></a>ESP32 TCP 服务端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> machine <span class="keyword">import</span> Timer,Pin,RTC <span class="comment">#调用GPIO口调用定时器库</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> emp_wifi <span class="keyword">import</span> Wifi</span><br><span class="line"><span class="keyword">import</span> network</span><br><span class="line">wifi = network.WLAN(network.STA_IF)</span><br><span class="line">wifi.active(<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 远程连接传输命令函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">connect_to_phone</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 注意：线连接到WiFi网络！</span></span><br><span class="line">        <span class="comment"># 如果未连接到网络，以下是连接到网络的代码</span></span><br><span class="line">        <span class="comment"># Wifi.connect()</span></span><br><span class="line">        ip = Wifi.ifconfig()[<span class="number">0</span>][<span class="number">0</span>]   <span class="comment">#获取IP地址</span></span><br><span class="line">        listenSocket = socket.socket()   <span class="comment">#创建套接字</span></span><br><span class="line">        listenSocket.bind((ip, port))   <span class="comment">#绑定地址和端口号</span></span><br><span class="line">        listenSocket.listen(<span class="number">1</span>)   <span class="comment">#监听套接字, 最多允许一个连接</span></span><br><span class="line">        listenSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)   <span class="comment">#设置套接字</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&#x27;tcp waiting...&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">&quot;accepting.....&quot;</span>)</span><br><span class="line">            conn, addr = listenSocket.accept()   <span class="comment">#接收连接请求，返回收发数据的套接字对象和客户端地址</span></span><br><span class="line">            print(addr, <span class="string">&quot;connected&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                data = conn.recv(<span class="number">1024</span>)   <span class="comment">#接收数据（1024字节大小）</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">len</span>(data) == <span class="number">0</span>):   <span class="comment">#判断客户端是否断开连接</span></span><br><span class="line">                    print(<span class="string">&quot;close socket&quot;</span>)</span><br><span class="line">                    conn.close()   <span class="comment">#关闭套接字</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#             print(data)</span></span><br><span class="line">                code_utf8 = <span class="built_in">bytes</span>.decode(data)</span><br><span class="line">                print(code_utf8)</span><br><span class="line">                ret = conn.send(data)   <span class="comment">#发送数据</span></span><br><span class="line">                <span class="keyword">if</span> code_utf8 == <span class="string">&quot;led1 open&quot;</span>:</span><br><span class="line">                    B.value(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">if</span> code_utf8 == <span class="string">&quot;led2 open&quot;</span>:</span><br><span class="line">                    C.value(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">if</span> code_utf8 == <span class="string">&quot;led1 down&quot;</span>:</span><br><span class="line">                    B.value(<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">if</span> code_utf8 == <span class="string">&quot;led2 down&quot;</span>:</span><br><span class="line">                    C.value(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">if</span>(listenSocket):   <span class="comment">#判断套接字是否为空</span></span><br><span class="line">            listenSocket.close()   <span class="comment">#关闭套接字</span></span><br><span class="line"></span><br><span class="line">wifi_connect()</span><br></pre></td></tr></table></figure><h3 id="PC-端"><a href="#PC-端" class="headerlink" title="PC 端"></a>PC 端</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="comment"># PC TCP Client</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket               <span class="comment"># 导入 socket 模块</span></span><br><span class="line"></span><br><span class="line">s = socket.socket()         <span class="comment"># 创建 socket 对象</span></span><br><span class="line">host = <span class="string">&#x27;192.168.2.231&#x27;</span>      <span class="comment"># esp32 ip</span></span><br><span class="line">port = <span class="number">10000</span>                <span class="comment"># 设置端口号</span></span><br><span class="line"></span><br><span class="line">s.connect((host, port))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        msg = raw_input(<span class="string">&#x27;&gt;&gt;&gt; &#x27;</span>)</span><br><span class="line">        s.send(msg)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ESP32 </tag>
            
            <tag> 物联网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>STM32开发环境搭建</title>
      <link href="2020/11/25/stm32_kai_fa_huan_jing_da_jian/stm32_kai_fa_huan_jing_da_jian/"/>
      <url>2020/11/25/stm32_kai_fa_huan_jing_da_jian/stm32_kai_fa_huan_jing_da_jian/</url>
      
        <content type="html"><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p><a target="_blank" rel="noopener" href="https://www.st.com/en/development-tools/stm32cubeide.html">Integrated Development Environment for STM32</a></p><p>汉化和安装主题请参考下面的链接<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/wct3344142/article/details/104142863">https://blog.csdn.net/wct3344142/article/details/104142863</a></p><p>我使用的网址是</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;eclipse&#x2F;technology&#x2F;babel&#x2F;update-site&#x2F;R0.18.1&#x2F;2019-12&#x2F;</span><br></pre></td></tr></table></figure><p>选项和上面的链接里的不一样<br><a href="https://hp-l.gitee.io/2020/11/25/STM32%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/stm32%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/IDE%E6%B1%89%E5%8C%96.png">thonny_download.png</a></p><h2 id="新建工程"><a href="#新建工程" class="headerlink" title="新建工程"></a>新建工程</h2><p>流程如图(点开查看大图)</p><p><img src="./IDE_new_project.png" class="lazyload placeholder" data-srcset="./IDE_new_project.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project"><br><img src="./IDE_new_project_1.png" class="lazyload placeholder" data-srcset="./IDE_new_project_1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_1"><br><img src="./IDE_new_project_2.png" class="lazyload placeholder" data-srcset="./IDE_new_project_2.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_2"></p><p><img src="./IDE_new_project_3.png" class="lazyload placeholder" data-srcset="./IDE_new_project_3.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_3"><br><img src="./IDE_new_project_4.png" class="lazyload placeholder" data-srcset="./IDE_new_project_4.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_4"><br><img src="./IDE_new_project_5.png" class="lazyload placeholder" data-srcset="./IDE_new_project_5.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_5"><br><img src="./IDE_new_project_6.png" class="lazyload placeholder" data-srcset="./IDE_new_project_6.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="IDE_new_project_6"></p>]]></content>
      
      
      
        <tags>
            
            <tag> STM32 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建Arduino_ESP2866环境</title>
      <link href="2020/11/21/da_jian_arduino_esp2866_huan_jing/da_jian_arduino_esp2866_huan_jing/"/>
      <url>2020/11/21/da_jian_arduino_esp2866_huan_jing/da_jian_arduino_esp2866_huan_jing/</url>
      
        <content type="html"><![CDATA[<h2 id="下载-Arduino-IDE"><a href="#下载-Arduino-IDE" class="headerlink" title="下载 Arduino IDE"></a>下载 Arduino IDE</h2><ul><li><p><a target="_blank" rel="noopener" href="https://www.arduino.cc/">Arduino 官网</a></p></li><li><p><a target="_blank" rel="noopener" href="https://downloads.arduino.cc/arduino-1.8.13-windows.zip">Arduino IDE 1.8.13</a></p></li></ul><p>下载完成后打开 arduino.exe<br><img src="./%E6%89%93%E5%BC%80arduino_IDE.png" class="lazyload placeholder" data-srcset="./%E6%89%93%E5%BC%80arduino_IDE.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="打开arduino_IDE.png"></p><h2 id="添加-json-文件"><a href="#添加-json-文件" class="headerlink" title="添加 json 文件"></a>添加 json 文件</h2><p>打开首选项<br><img src="./%E9%A6%96%E9%80%89%E9%A1%B9.png" class="lazyload placeholder" data-srcset="./%E9%A6%96%E9%80%89%E9%A1%B9.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="首选项.png"><br><img src="./%E7%AE%A1%E7%90%86%E5%99%A8%E7%BD%91%E5%9D%80.png" class="lazyload placeholder" data-srcset="./%E7%AE%A1%E7%90%86%E5%99%A8%E7%BD%91%E5%9D%80.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="管理器网址.png"><br>在开发板管理器网址填入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;arduino.esp8266.com&#x2F;stable&#x2F;package_esp8266com_index.json</span><br></pre></td></tr></table></figure><p>或者</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;wechat.doit.am&#x2F;package_esp8266com_index.json</span><br></pre></td></tr></table></figure><p>在<a target="_blank" rel="noopener" href="https://github.com/esp8266/Arduino">GitHub 上的项目</a>里有最新的版本，但是需要科学上网所以选择第二个</p><h2 id="添加-ESP8266-开发板"><a href="#添加-ESP8266-开发板" class="headerlink" title="添加 ESP8266 开发板"></a>添加 ESP8266 开发板</h2><p>搜索栏键入 8266<br><img src="./%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E6%9D%BF.png" class="lazyload placeholder" data-srcset="./%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E6%9D%BF.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="添加开发板.png"><br><img src="./%E6%9F%A5%E6%89%BE%E5%BC%80%E5%8F%91%E6%9D%BF.png" class="lazyload placeholder" data-srcset="./%E6%9F%A5%E6%89%BE%E5%BC%80%E5%8F%91%E6%9D%BF.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="查找开发板.png"><br>如果出现下载失败可以从这里下载</p><ul><li><p>如果安装过其他版本的 esp8266sdk，请先删除，再使用本安装包。</p></li><li><p>解压完成后，再打开 Arduino IDE，即可在 菜单栏&gt;工具&gt;开发板 中找到你使用的 esp8266 开发板。</p></li></ul><p>来自 Arduino 中文社区的大佬</p><ul><li><a target="_blank" rel="noopener" href="https://share.weiyun.com/5CGEKJO">https://share.weiyun.com/5CGEKJO</a></li></ul><p>安装完成后重启 Arduino IDE 就会有显示了<br><img src="./END.png" class="lazyload placeholder" data-srcset="./END.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="END.png"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Arduino </tag>
            
            <tag> ESP2866 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手机定时切换壁纸</title>
      <link href="2020/11/15/shou_ji_ding_shi_qie_huan_bi_zhi/shou_ji_ding_shi_qie_huan_bi_zhi/"/>
      <url>2020/11/15/shou_ji_ding_shi_qie_huan_bi_zhi/shou_ji_ding_shi_qie_huan_bi_zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ol><li><p>手机安装 termuxAPP 和 termux_API (这里给出参考博客链接)</p><ul><li><p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2018/05/termux.html">国光的 Termux 高级终端安装使用配置教程</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2018/05/termux.html#toc-heading-3">跳转下载链接</a></p></li><li><p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2018/05/termux.html#toc-heading-167">API 下载链接</a></p></li></ul></li><li><p>完成基础的安装</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pkg install termux-api  <span class="comment">#termux-API</span></span><br><span class="line">pkg install cronie      <span class="comment">#linux 定时软件</span></span><br></pre></td></tr></table></figure><h2 id="编辑定时运行的-shell-脚本"><a href="#编辑定时运行的-shell-脚本" class="headerlink" title="编辑定时运行的 shell 脚本"></a>编辑定时运行的 shell 脚本</h2><p>编辑 bizhi.sh 文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">termux-wallpaper -f ./壁纸所在目录/$((RANDOM%<span class="number">152</span>+<span class="number">1</span>)).jpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># $((RANDOM%152+1))是用来随机取数的</span></span><br><span class="line"><span class="comment"># $((RANDOM%152+1))可以换成文件名</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/11/15/DxGUVOYLvrMKJc7.png" class="lazyload placeholder" data-srcset="https://i.loli.net/2020/11/15/DxGUVOYLvrMKJc7.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="我的文件命名格式"></p><h2 id="编辑定时任务文件"><a href="#编辑定时任务文件" class="headerlink" title="编辑定时任务文件"></a>编辑定时任务文件</h2><p>终端输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>再输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 每隔五分钟执行一次bizhi.sh文件</span><br><span class="line">*&#x2F;5 * * * * .&#x2F;文件路径&#x2F;bizhi.sh</span><br></pre></td></tr></table></figure><p>应为 Termux 默认不启动 crontab，所以进入 Termux 要开启一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crond start <span class="comment">#开启</span></span><br></pre></td></tr></table></figure><p>在手机设置中，termux 和 termux-API 都开启手动管理</p><p><img src="https://i.loli.net/2020/11/15/I3X1TJlPrbMBypf.jpg" class="lazyload placeholder" data-srcset="https://i.loli.net/2020/11/15/I3X1TJlPrbMBypf.jpg" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="手机管理页面"></p><iframe height=520 width=776   src="//player.bilibili.com/player.html?aid=458590572&bvid=BV1Y5411n7tx&cid=280885187&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="max-width: 100%, text-align: center" > </iframe>]]></content>
      
      
      
        <tags>
            
            <tag> termux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Micropython联网同步时间</title>
      <link href="2020/11/09/micropython_lian_wang_tong_bu_shi_jian/micropython_lian_wang_tong_bu_shi_jian/"/>
      <url>2020/11/09/micropython_lian_wang_tong_bu_shi_jian/micropython_lian_wang_tong_bu_shi_jian/</url>
      
        <content type="html"><![CDATA[<!--headimg: https://tse2-mm.cn.bing.net/th/id/OIP.I-Dxm4tGXel1krdRKZEdlwHaB9?pid=Api&rs=1 --><!--headimg: https://tse2-mm.cn.bing.net/th/id/OIP.I-Dxm4tGXel1krdRKZEdlwHaB9?pid=Api&rs=1--><!--960px*450px--><!--headimg: https://res.cloudinary.com/practicaldev/image/fetch/s--_ggXRYud--/c_imagga_scale,f_auto,fl_progressive,h_500,q_auto,w_1000/https://thepracticaldev.s3.amazonaws.com/i/fww14sbviudb7xbvckhw.png--><!--960px*450px--><!--640px*300px--><p>ntp 服务器可以自己选择，可以使用爬虫爬去时间也可以用 NTP 服务器同步，将 wifi_connect()函数最后一行 get_time_py 换成 get_time()即可<br>直接上程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"># This file is executed on every boot (including wake-boot from deepsleep)</span><br><span class="line">#import esp</span><br><span class="line">#esp.osdebug(None)</span><br><span class="line">#import webrepl</span><br><span class="line">#webrepl.start()</span><br><span class="line"></span><br><span class="line">#使用ESP32上的MicroPython連接Wi-Fi網絡</span><br><span class="line">from machine import Pin,RTC</span><br><span class="line">import network    #網絡模塊</span><br><span class="line">import time       #計時器模塊</span><br><span class="line">import ntptime    #ntptime網絡時間協議模塊</span><br><span class="line"></span><br><span class="line">#自动联网</span><br><span class="line">def wifi_connect():</span><br><span class="line">  wifi_led&#x3D;Pin(18,Pin.OUT)             # 初始化LED燈，可自定義</span><br><span class="line">  wlan &#x3D; network.WLAN(network.STA_IF)  #</span><br><span class="line">  wlan.active(True)                    # 激活網絡接口</span><br><span class="line">  start_time&#x3D;time.time()               # 記錄開始時間</span><br><span class="line"></span><br><span class="line">  if not wlan.isconnected():              # 如若聯網失敗</span><br><span class="line">    print(&quot;当前无线未联网，正在连接中....&quot;)</span><br><span class="line">    # wlan.connect(&quot;此处改为你的无线网名称&quot;, &quot;无线网密码&quot;)</span><br><span class="line">    wlan.connect(&#39;XXXXXXXX&#39;,&#39;XXXXXXXX&#39;)   # 無綫網SSID、密碼</span><br><span class="line">    while not wlan.isconnected():         # 如若還未連接成功，LED則會以閃爍的方式提示未連接到WIFI</span><br><span class="line">      wifi_led.value(0)</span><br><span class="line">      time.sleep_ms(1000)       # 延時函數1000毫秒</span><br><span class="line">      wifi_led.value(1)</span><br><span class="line">      time.sleep_ms(1000)</span><br><span class="line">      print(&quot;正在尝试连接到wifi....&quot;)</span><br><span class="line">      print(time.time())</span><br><span class="line"></span><br><span class="line">      if time.time()-start_time&gt;15:       # 如若超過15秒還未連接則退出鏈接</span><br><span class="line">        print(&quot;連接失敗!!!請檢查無綫網名稱和密碼是否正確...&quot;)</span><br><span class="line">        break</span><br><span class="line"></span><br><span class="line">  if wlan.isconnected():                  # 如若連接成功</span><br><span class="line">    wifi_led.value(1)                     # LED燈常亮</span><br><span class="line">    IP_info&#x3D;wlan.ifconfig()</span><br><span class="line">    print(&quot;##################################################&quot;)</span><br><span class="line">    print(&quot;已連接WIFI，信息如下：&quot;)</span><br><span class="line">    print(&quot;IP地址：&quot;+IP_info[0])</span><br><span class="line">    print(&quot;子網掩碼：&quot;+IP_info[1])</span><br><span class="line">    print(&quot;網関：&quot;+IP_info[2])</span><br><span class="line">    print(&quot;DNS：&quot;+IP_info[3])</span><br><span class="line">    print(&quot;##################################################&quot;)</span><br><span class="line">    get_time_py()</span><br><span class="line"></span><br><span class="line">#同步時間</span><br><span class="line">def get_time():</span><br><span class="line">    print(&quot;同步時間&quot;)</span><br><span class="line">    print()</span><br><span class="line">    print(&quot;同步前本地時間：%s&quot; %str(time.localtime()))</span><br><span class="line">    print(&quot;##&quot;)</span><br><span class="line">    ntptime.NTP_DELTA &#x3D; 3155644800    # 設置  UTC+8偏移時間（秒），不不設置就是UTC0</span><br><span class="line">#     ntptime.host &#x3D; &#39;pool.ntp.org&#39;  # 可選ntp服務器為阿里雲服務器，默認是&quot;pool.ntp.org&quot;</span><br><span class="line">    ntptime.host &#x3D; &#39;edu.ntp.org.cn&#39;</span><br><span class="line">#     ntptime.host &#x3D; &#39;210.72.145.44&#39; # 國家授時中心服務器IP地址</span><br><span class="line">#     ntptime.host &#x3D; &#39;ntp1.aliyun.com&#39;</span><br><span class="line">#     ntptime.host &#x3D; &#39;cn.ntp.org.cn&#39;</span><br><span class="line">    ntptime.settime()                 # 修改設備時間</span><br><span class="line">    print(&quot;同步后本地時間：%s&quot; %str(time.localtime()))</span><br><span class="line">    print(&quot;##################################################&quot;)</span><br><span class="line">    rtc &#x3D; RTC()</span><br><span class="line">    print(rtc.datetime())</span><br><span class="line"></span><br><span class="line"># 爬取時間</span><br><span class="line">def get_time_py():</span><br><span class="line">    time_api_url &#x3D; &quot;&quot;&quot;http:&#x2F;&#x2F;quan.suning.com&#x2F;getSysTime.do&quot;&quot;&quot;</span><br><span class="line">    r &#x3D; request.get(time_api_url)</span><br><span class="line">    content &#x3D; r.text</span><br><span class="line">    print(&#39;爬取時間...&#39;)</span><br><span class="line">    time &#x3D; re.search(</span><br><span class="line">        r&#39;&#123;&quot;sysTime2&quot;:&quot;(.*?)-(.*?)-(.*?) (.*?):(.*?):(.*?)&quot;,&quot;sysTime1&quot;:&quot;&#39;, content</span><br><span class="line">        )</span><br><span class="line">    print(r.text[13:29])</span><br><span class="line">    print(int(r.text[27:29]))</span><br><span class="line">    print(int(r.text[23:26]))</span><br><span class="line">    mm &#x3D; int(r.text[27:29])# 分鐘</span><br><span class="line">    hh &#x3D; int(r.text[23:26])# 小時</span><br><span class="line">    rtc &#x3D; RTC()</span><br><span class="line">    time_date &#x3D; rtc.datetime()</span><br><span class="line">    print(&#39;重置時間！&#39;)</span><br><span class="line">    rtc.datetime((time_date[0], time_date[1], time_date[2], time_date[3], hh, mm, time_date[6], time_date[7]))</span><br><span class="line">    rtc.datetime()</span><br><span class="line"></span><br><span class="line">#開始執行聯網</span><br><span class="line">wifi_connect()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> micropython </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP32_micropython固件烧录</title>
      <link href="2020/11/05/esp32_micropython_gu_jian_shao_lu/esp32_micropython_gu_jian_shao_lu/"/>
      <url>2020/11/05/esp32_micropython_gu_jian_shao_lu/esp32_micropython_gu_jian_shao_lu/</url>
      
        <content type="html"><![CDATA[<h2 id="ESP32-micropython-固件烧录"><a href="#ESP32-micropython-固件烧录" class="headerlink" title="ESP32_micropython 固件烧录"></a>ESP32_micropython 固件烧录</h2><h3 id="烧录准备"><a href="#烧录准备" class="headerlink" title="烧录准备"></a>烧录准备</h3><p>1.micropython IDE：<a target="_blank" rel="noopener" href="https://thonny.org/">Thonny</a></p><p><img src="./thonny_download.png" class="lazyload placeholder" data-srcset="./thonny_download.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="thonny_download.png"></p><p>2.ESP32 的 micropython 固件：<a target="_blank" rel="noopener" href="https://www.micropython.org/download/esp32/">戳我进下载页面</a>，micropython 还支持其他芯片<a target="_blank" rel="noopener" href="https://www.micropython.org/download/">link</a>，下载页面有很多固件选择，由于我的是不带 SPIRAM 的，因此我选择了第一个。</p><p><img src="./micropython%E5%9B%BA%E4%BB%B6.png" class="lazyload placeholder" data-srcset="./micropython%E5%9B%BA%E4%BB%B6.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="micropython固件"></p><p>3.烧录工具：<br>这里提供两种，esptool 在 GitHub 上有教程，这里就不细讲。</p><ul><li><p>esptool：<a target="_blank" rel="noopener" href="https://github.com/espressif/esptool">github link</a></p></li><li><p>Thonny: micropython IDE</p></li><li><p>Flash 下载工具：<a target="_blank" rel="noopener" href="https://www.espressif.com/support/download/other-tools">link</a></p><p><img src="./%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7.png" class="lazyload placeholder" data-srcset="./%E7%83%A7%E5%BD%95%E5%B7%A5%E5%85%B7.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="烧录工具.png"></p></li></ul><p>4.ESP32 模组： 打开淘宝……</p><h3 id="烧录过程"><a href="#烧录过程" class="headerlink" title="烧录过程"></a>烧录过程</h3><h4 id="使用-Thonny-烧录"><a href="#使用-Thonny-烧录" class="headerlink" title="使用 Thonny 烧录"></a>使用 Thonny 烧录</h4><p>点击工具栏运行，选择“选择解释器…”</p><p><img src="./Thonny_%E7%83%A7%E5%BD%95%E5%9B%BA%E4%BB%B6.png" class="lazyload placeholder" data-srcset="./Thonny_%E7%83%A7%E5%BD%95%E5%9B%BA%E4%BB%B6.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="Thonny_烧录固件.png"><br><img src="./Thonny_%E7%83%A7%E5%BD%95%E5%9B%BA%E4%BB%B61.png" class="lazyload placeholder" data-srcset="./Thonny_%E7%83%A7%E5%BD%95%E5%9B%BA%E4%BB%B61.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="Thonny_烧录固件1.png"></p><p>选择我们在 Micropython 官网下载的固件后点击 install<br>这是从 ESP 官网上下载的启动模式方法：</p><p><img src="./%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F.png" class="lazyload placeholder" data-srcset="./%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="启动模式.png"><br><img src="./%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F1.png" class="lazyload placeholder" data-srcset="./%E5%90%AF%E5%8A%A8%E6%A8%A1%E5%BC%8F1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="启动模式1.png"></p><p>即GPIO0和GPIO2全部接地，同时按下复位按键，保持1毫秒再断开GPIO0断开接地（因为 GPIO0 默认上拉），便开始下载。</p><h4 id="使用-Flash-下载工具"><a href="#使用-Flash-下载工具" class="headerlink" title="使用 Flash 下载工具"></a>使用 Flash 下载工具</h4><p>从官网下载了工具后双击打开，等待几秒后，点击 ESP32downloadTools，选择我们在 Micropython 官网下载的固件后点击 START</p><p><img src="./flash_download.png" class="lazyload placeholder" data-srcset="./flash_download.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="flash_download.png"><br><img src="./flash_download1.png" class="lazyload placeholder" data-srcset="./flash_download1.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="flash_download1.png"></p><p>再按照上文中的启动方法启动即可下载。</p><p>成功之后 shell 会出现下图：</p><p><img src="./SHELL.png" class="lazyload placeholder" data-srcset="./SHELL.png" srcset="https://i.loli.net/2020/11/07/wHEd8N3iupP6vIr.gif" alt="SHELL.png"></p><p>像 python 一样可以实时输入，ESP32 可以直接看到 LED 灯被点亮</p>]]></content>
      
      
      
        <tags>
            
            <tag> ESP32 </tag>
            
            <tag> micropython </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
